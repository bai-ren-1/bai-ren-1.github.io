<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="白仁的博客" type="application/atom+xml" />






<meta name="description" content="Java审计-DAY2本文转载自 https:&#x2F;&#x2F;blog.csdn.net&#x2F;niexinming&#x2F;article&#x2F;details&#x2F;84312701  xml解析导致xxe漏洞漏洞特征：XXE_XMLSTREAMREADER当xml解析程序收到不信任的输入且如果xml解析程序支持外部实体解析的时候，那么造成xml实体解析攻击（xxe）危害1：探测本地文件内容（xxe：xml 外部实体） 1234&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="Java审计-DAY2">
<meta property="og:url" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2019&#x2F;11&#x2F;02&#x2F;Java%E5%AE%A1%E8%AE%A1-DAY2&#x2F;index.html">
<meta property="og:site_name" content="白仁的博客">
<meta property="og:description" content="Java审计-DAY2本文转载自 https:&#x2F;&#x2F;blog.csdn.net&#x2F;niexinming&#x2F;article&#x2F;details&#x2F;84312701  xml解析导致xxe漏洞漏洞特征：XXE_XMLSTREAMREADER当xml解析程序收到不信任的输入且如果xml解析程序支持外部实体解析的时候，那么造成xml实体解析攻击（xxe）危害1：探测本地文件内容（xxe：xml 外部实体） 1234&amp;">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-03-06T09:29:20.534Z">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://bai-ren-1.github.io/2019/11/02/Java审计-DAY2/"/>





  <title>Java审计-DAY2 | 白仁的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">白仁的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bai-ren-1.github.io/2019/11/02/Java%E5%AE%A1%E8%AE%A1-DAY2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="白仁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白仁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java审计-DAY2</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-11-02T14:56:50+08:00">
                2019-11-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/WEB%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">WEB安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Java审计-DAY2"><a href="#Java审计-DAY2" class="headerlink" title="Java审计-DAY2"></a>Java审计-DAY2</h1><p>本文转载自 <a href="https://blog.csdn.net/niexinming/article/details/84312701" target="_blank" rel="noopener">https://blog.csdn.net/niexinming/article/details/84312701</a> </p>
<h1 id="xml解析导致xxe漏洞"><a href="#xml解析导致xxe漏洞" class="headerlink" title="xml解析导致xxe漏洞"></a>xml解析导致xxe漏洞</h1><p>漏洞特征：XXE_XMLSTREAMREADER<br>当xml解析程序收到不信任的输入且如果xml解析程序支持外部实体解析的时候，那么造成xml实体解析攻击（xxe）<br>危害1：探测本地文件内容（xxe：xml 外部实体）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">   &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt; ]&gt;</span><br><span class="line">&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<p>危害2：拒绝服务攻击 （xee：xml 外部实体膨胀）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE lolz [</span><br><span class="line"> &lt;!ENTITY lol &quot;lol&quot;&gt;</span><br><span class="line"> &lt;!ELEMENT lolz (#PCDATA)&gt;</span><br><span class="line"> &lt;!ENTITY lol1 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol2 &quot;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;</span><br><span class="line">[...]</span><br><span class="line"> &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;</span><br></pre></td></tr></table></figure>

<p>解决方法：<br>为了避免解析xml带来的攻击，你应该按照下面的示例代码修改你的代码<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public void parseXML(InputStream input) throws XMLStreamException &#123;</span><br><span class="line"></span><br><span class="line">    XMLInputFactory factory = XMLInputFactory.newFactory();</span><br><span class="line">    XMLStreamReader reader = factory.createXMLStreamReader(input);</span><br><span class="line">    [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>禁用外部实体的解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void parseXML(InputStream input) throws XMLStreamException &#123;</span><br><span class="line"></span><br><span class="line">    XMLInputFactory factory = XMLInputFactory.newFactory();</span><br><span class="line">    factory.setProperty(XMLInputFactory.IS_SUPPORTING_EXTERNAL_ENTITIES, false);</span><br><span class="line">    XMLStreamReader reader = factory.createXMLStreamReader(input);</span><br><span class="line">    [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>禁用DTD的方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void parseXML(InputStream input) throws XMLStreamException &#123;</span><br><span class="line"></span><br><span class="line">    XMLInputFactory factory = XMLInputFactory.newFactory();</span><br><span class="line">    factory.setProperty(XMLInputFactory.SUPPORT_DTD, false);</span><br><span class="line">    XMLStreamReader reader = factory.createXMLStreamReader(input);</span><br><span class="line">    [...]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引用：<br><a href="http://cwe.mitre.org/data/definitions/611.html" target="_blank" rel="noopener">CWE-611: Improper Restriction of XML External Entity Reference (‘XXE’)</a><br><a href="https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=61702260" target="_blank" rel="noopener">CERT: IDS10-J. Prevent XML external entity attacks</a><br><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing" target="_blank" rel="noopener">OWASP.org: XML External Entity (XXE) Processing</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Expansion" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Expansion</a><br><a href="http://www.ws-attacks.org/index.php/XML_External_Entity_DOS" target="_blank" rel="noopener">WS-Attacks.org: XML External Entity DOS</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Reference_Attack" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Reference Attack</a><br><a href="http://blog.h3xstream.com/2014/06/identifying-xml-external-entity.html" target="_blank" rel="noopener">Identifying Xml eXternal Entity vulnerability (XXE)</a><br><a href="http://openjdk.java.net/jeps/185" target="_blank" rel="noopener">JEP 185: Restrict Fetching of External XML Resources</a></p>
<h1 id="xml解析导致xxe漏洞-XPathExpression"><a href="#xml解析导致xxe漏洞-XPathExpression" class="headerlink" title="xml解析导致xxe漏洞(XPathExpression)"></a>xml解析导致xxe漏洞(XPathExpression)</h1><p>漏洞特征：XXE_XPATH<br>当xml解析程序收到不信任的输入且如果xml解析程序支持外部实体解析的时候，那么造成xml实体解析攻击（xxe）<br>危害1：探测本地文件内容（xxe：xml 外部实体）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">   &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt; ]&gt;</span><br><span class="line">&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<p>危害2：拒绝服务攻击 （xee：xml 外部实体膨胀）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE lolz [</span><br><span class="line"> &lt;!ENTITY lol &quot;lol&quot;&gt;</span><br><span class="line"> &lt;!ELEMENT lolz (#PCDATA)&gt;</span><br><span class="line"> &lt;!ENTITY lol1 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol2 &quot;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;</span><br><span class="line">[...]</span><br><span class="line"> &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;</span><br></pre></td></tr></table></figure>

<p>解决方法：<br>为了避免解析xml带来的攻击，你应该按照下面的示例代码修改你的代码<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilder builder = df.newDocumentBuilder();</span><br><span class="line"></span><br><span class="line">XPathFactory xPathFactory = XPathFactory.newInstance();</span><br><span class="line">XPath xpath = xPathFactory.newXPath();</span><br><span class="line">XPathExpression xPathExpr = xpath.compile(&quot;/somepath/text()&quot;);</span><br><span class="line"></span><br><span class="line">xPathExpr.evaluate(new InputSource(inputStream));</span><br></pre></td></tr></table></figure>

<p>下面的两个片段展示了可能的解决方案。你可以设置其中一个，或者两个都设置</p>
<p>使用”Secure processing” 模式的解决方案</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilderFactory df = DocumentBuilderFactory.newInstance();</span><br><span class="line">df.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</span><br><span class="line">DocumentBuilder builder = df.newDocumentBuilder();</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">xPathExpr.evaluate( builder.parse(inputStream) );</span><br></pre></td></tr></table></figure>

<p>禁用DTD的解决方案：<br>通过禁用DTD，大多数的xxe攻击都可以被避免</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilderFactory df = DocumentBuilderFactory.newInstance();</span><br><span class="line">spf.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);</span><br><span class="line">DocumentBuilder builder = df.newDocumentBuilder();</span><br><span class="line"></span><br><span class="line">[...]</span><br><span class="line"></span><br><span class="line">xPathExpr.evaluate( builder.parse(inputStream) );</span><br></pre></td></tr></table></figure>

<p>引用：<br><a href="http://cwe.mitre.org/data/definitions/611.html" target="_blank" rel="noopener">CWE-611: Improper Restriction of XML External Entity Reference (‘XXE’)</a><br><a href="https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=61702260" target="_blank" rel="noopener">CERT: IDS10-J. Prevent XML external entity attacks</a><br><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing" target="_blank" rel="noopener">OWASP.org: XML External Entity (XXE) Processing</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Expansion" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Expansion</a><br><a href="http://www.ws-attacks.org/index.php/XML_External_Entity_DOS" target="_blank" rel="noopener">WS-Attacks.org: XML External Entity DOS</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Reference_Attack" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Reference Attack</a><br><a href="http://blog.h3xstream.com/2014/06/identifying-xml-external-entity.html" target="_blank" rel="noopener">Identifying Xml eXternal Entity vulnerability (XXE)</a><br><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Prevention_Cheat_Sheet#XPathExpression" target="_blank" rel="noopener">XML External Entity (XXE) Prevention Cheat Sheet</a></p>
<h1 id="xml解析导致xxe漏洞-SAXParser"><a href="#xml解析导致xxe漏洞-SAXParser" class="headerlink" title="xml解析导致xxe漏洞(SAXParser)"></a>xml解析导致xxe漏洞(SAXParser)</h1><p>漏洞特征：XXE_SAXPARSER<br>当xml解析程序收到不信任的输入且如果xml解析程序支持外部实体解析的时候，那么造成xml实体解析攻击（xxe）<br>危害1：探测本地文件内容（xxe：xml 外部实体）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">   &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt; ]&gt;</span><br><span class="line">&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<p>危害2：拒绝服务攻击 （xee：xml 外部实体膨胀）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE lolz [</span><br><span class="line"> &lt;!ENTITY lol &quot;lol&quot;&gt;</span><br><span class="line"> &lt;!ELEMENT lolz (#PCDATA)&gt;</span><br><span class="line"> &lt;!ENTITY lol1 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol2 &quot;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;</span><br><span class="line">[...]</span><br><span class="line"> &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;</span><br></pre></td></tr></table></figure>

<p>解决方法：<br>为了避免解析xml带来的攻击，你应该按照下面的示例代码修改你的代码<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SAXParser parser = SAXParserFactory.newInstance().newSAXParser();</span><br><span class="line"></span><br><span class="line">parser.parse(inputStream, customHandler);</span><br></pre></td></tr></table></figure>

<p>下面的两个片段展示了可能的解决方案。你可以使用其中一个，或者两个都使用</p>
<p><strong>使用”Secure processing” 模式的解决方案:</strong><br>这个设置能保护你能避免拒绝服务攻击和ssrf漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SAXParserFactory spf = SAXParserFactory.newInstance();</span><br><span class="line">spf.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</span><br><span class="line">SAXParser parser = spf.newSAXParser();</span><br><span class="line"></span><br><span class="line">parser.parse(inputStream, customHandler);</span><br></pre></td></tr></table></figure>

<p><strong>禁用DTD的解决方案:</strong><br>通过禁用DTD，大多数的xxe攻击都可以被避免</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SAXParserFactory spf = SAXParserFactory.newInstance();</span><br><span class="line">spf.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);</span><br><span class="line">SAXParser parser = spf.newSAXParser();</span><br><span class="line"></span><br><span class="line">parser.parse(inputStream, customHandler);</span><br></pre></td></tr></table></figure>

<p>引用：<br><a href="http://cwe.mitre.org/data/definitions/611.html" target="_blank" rel="noopener">CWE-611: Improper Restriction of XML External Entity Reference (‘XXE’)</a><br><a href="https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=61702260" target="_blank" rel="noopener">CERT: IDS10-J. Prevent XML external entity attacks</a><br><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing" target="_blank" rel="noopener">OWASP.org: XML External Entity (XXE) Processing</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Expansion" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Expansion</a><br><a href="http://www.ws-attacks.org/index.php/XML_External_Entity_DOS" target="_blank" rel="noopener">WS-Attacks.org: XML External Entity DOS</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Reference_Attack" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Reference Attack</a><br><a href="http://blog.h3xstream.com/2014/06/identifying-xml-external-entity.html" target="_blank" rel="noopener">Identifying Xml eXternal Entity vulnerability (XXE)</a><br><a href="http://xerces.apache.org/xerces-j/features.html" target="_blank" rel="noopener">Xerces complete features list</a></p>
<h1 id="xml解析导致xxe漏洞-XMLReader"><a href="#xml解析导致xxe漏洞-XMLReader" class="headerlink" title="xml解析导致xxe漏洞(XMLReader)"></a>xml解析导致xxe漏洞(XMLReader)</h1><p>漏洞特征：XXE_XMLREADER<br>当xml解析程序收到不信任的输入且如果xml解析程序支持外部实体解析的时候，那么造成xml实体解析攻击（xxe）<br>危害1：探测本地文件内容（xxe：xml 外部实体）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">   &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt; ]&gt;</span><br><span class="line">&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<p>危害2：拒绝服务攻击 （xee：xml 外部实体膨胀）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE lolz [</span><br><span class="line"> &lt;!ENTITY lol &quot;lol&quot;&gt;</span><br><span class="line"> &lt;!ELEMENT lolz (#PCDATA)&gt;</span><br><span class="line"> &lt;!ENTITY lol1 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol2 &quot;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;</span><br><span class="line">[...]</span><br><span class="line"> &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;</span><br></pre></td></tr></table></figure>

<p>解决方法：<br>为了避免解析xml带来的攻击，你应该按照下面的示例代码修改你的代码<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XMLReader reader = XMLReaderFactory.createXMLReader();</span><br><span class="line">reader.setContentHandler(customHandler);</span><br><span class="line">reader.parse(new InputSource(inputStream));</span><br></pre></td></tr></table></figure>

<p>下面的两个片段展示了可能的解决方案。你可以使用其中一个，或者两个都使用</p>
<p><strong>使用”Secure processing” 模式的解决方案:</strong><br>这个设置能保护你能避免拒绝服务攻击和ssrf漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">XMLReader reader = XMLReaderFactory.createXMLReader();</span><br><span class="line">reader.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</span><br><span class="line">reader.setContentHandler(customHandler);</span><br><span class="line"></span><br><span class="line">reader.parse(new InputSource(inputStream));</span><br></pre></td></tr></table></figure>

<p><strong>禁用DTD的解决方案:</strong><br>通过禁用DTD，大多数的xxe攻击都可以被避免</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">XMLReader reader = XMLReaderFactory.createXMLReader();</span><br><span class="line">reader.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);</span><br><span class="line">reader.setContentHandler(customHandler);</span><br><span class="line"></span><br><span class="line">reader.parse(new InputSource(inputStream));</span><br></pre></td></tr></table></figure>

<p>引用：<br><a href="http://cwe.mitre.org/data/definitions/611.html" target="_blank" rel="noopener">CWE-611: Improper Restriction of XML External Entity Reference (‘XXE’)</a><br><a href="https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=61702260" target="_blank" rel="noopener">CERT: IDS10-J. Prevent XML external entity attacks</a><br><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing" target="_blank" rel="noopener">OWASP.org: XML External Entity (XXE) Processing</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Expansion" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Expansion</a><br><a href="http://www.ws-attacks.org/index.php/XML_External_Entity_DOS" target="_blank" rel="noopener">WS-Attacks.org: XML External Entity DOS</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Reference_Attack" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Reference Attack</a><br><a href="http://blog.h3xstream.com/2014/06/identifying-xml-external-entity.html" target="_blank" rel="noopener">Identifying Xml eXternal Entity vulnerability (XXE)</a><br><a href="http://xerces.apache.org/xerces-j/features.html" target="_blank" rel="noopener">Xerces complete features list</a></p>
<h1 id="xml解析导致xxe漏洞-DocumentBuilder"><a href="#xml解析导致xxe漏洞-DocumentBuilder" class="headerlink" title="xml解析导致xxe漏洞(DocumentBuilder)"></a>xml解析导致xxe漏洞(DocumentBuilder)</h1><p>漏洞特征：XXE_DOCUMENT<br>当xml解析程序收到不信任的输入且如果xml解析程序支持外部实体解析的时候，那么造成xml实体解析攻击（xxe）<br>危害1：探测本地文件内容（xxe：xml 外部实体）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">   &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt; ]&gt;</span><br><span class="line">&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<p>危害2：拒绝服务攻击 （xee：xml 外部实体膨胀）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE lolz [</span><br><span class="line"> &lt;!ENTITY lol &quot;lol&quot;&gt;</span><br><span class="line"> &lt;!ELEMENT lolz (#PCDATA)&gt;</span><br><span class="line"> &lt;!ENTITY lol1 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol2 &quot;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;</span><br><span class="line">[...]</span><br><span class="line"> &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;</span><br></pre></td></tr></table></figure>

<p>解决方法：<br>为了避免解析xml带来的攻击，你应该按照下面的示例代码修改你的代码<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilder db = DocumentBuilderFactory.newInstance().newDocumentBuilder();</span><br><span class="line"></span><br><span class="line">Document doc = db.parse(input);</span><br></pre></td></tr></table></figure>

<p>下面的两个片段展示了可能的解决方案。你可以使用其中一个，或者两个都使用</p>
<p><strong>使用”Secure processing” 模式的解决方案:</strong><br>这个设置能保护你能避免拒绝服务攻击和ssrf漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</span><br><span class="line">DocumentBuilder db = dbf.newDocumentBuilder();</span><br><span class="line"></span><br><span class="line">Document doc = db.parse(input);</span><br></pre></td></tr></table></figure>

<p><strong>禁用DTD的解决方案:</strong><br>通过禁用DTD，大多数的xxe攻击都可以被避免</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);</span><br><span class="line">DocumentBuilder db = dbf.newDocumentBuilder();</span><br><span class="line"></span><br><span class="line">Document doc = db.parse(input);</span><br></pre></td></tr></table></figure>

<p>引用：<br><a href="http://cwe.mitre.org/data/definitions/611.html" target="_blank" rel="noopener">CWE-611: Improper Restriction of XML External Entity Reference (‘XXE’)</a><br><a href="https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=61702260" target="_blank" rel="noopener">CERT: IDS10-J. Prevent XML external entity attacks</a><br><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing" target="_blank" rel="noopener">OWASP.org: XML External Entity (XXE) Processing</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Expansion" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Expansion</a><br><a href="http://www.ws-attacks.org/index.php/XML_External_Entity_DOS" target="_blank" rel="noopener">WS-Attacks.org: XML External Entity DOS</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Reference_Attack" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Reference Attack</a><br><a href="http://blog.h3xstream.com/2014/06/identifying-xml-external-entity.html" target="_blank" rel="noopener">Identifying Xml eXternal Entity vulnerability (XXE)</a><br><a href="http://xerces.apache.org/xerces-j/features.html" target="_blank" rel="noopener">Xerces complete features list</a></p>
<h1 id="xml解析导致xxe漏洞-TransformerFactory"><a href="#xml解析导致xxe漏洞-TransformerFactory" class="headerlink" title="xml解析导致xxe漏洞(TransformerFactory)"></a>xml解析导致xxe漏洞(TransformerFactory)</h1><p>漏洞特征：XXE_DTD_TRANSFORM_FACTORY<br>当xml解析程序收到不信任的输入且如果xml解析程序支持外部实体解析的时候，那么造成xml实体解析攻击（xxe）<br>危害1：探测本地文件内容（xxe：xml 外部实体）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">   &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt; ]&gt;</span><br><span class="line">&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span><br></pre></td></tr></table></figure>

<p>危害2：拒绝服务攻击 （xee：xml 外部实体膨胀）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE lolz [</span><br><span class="line"> &lt;!ENTITY lol &quot;lol&quot;&gt;</span><br><span class="line"> &lt;!ELEMENT lolz (#PCDATA)&gt;</span><br><span class="line"> &lt;!ENTITY lol1 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol2 &quot;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&amp;lol1;&quot;&gt;</span><br><span class="line"> &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;</span><br><span class="line">[...]</span><br><span class="line"> &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;lolz&gt;&amp;lol9;&lt;/lolz&gt;</span><br></pre></td></tr></table></figure>

<p>解决方法：<br>为了避免解析xml带来的攻击，你应该按照下面的示例代码修改你的代码<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Transformer transformer = TransformerFactory.newInstance().newTransformer();</span><br><span class="line">transformer.transform(input, result);</span><br></pre></td></tr></table></figure>

<p>下面的两个片段展示了可能的解决方案。你可以使用其中一个，或者两个都使用</p>
<p><strong>使用”Secure processing” 模式的解决方案:</strong><br>这个设置能保护你能避免拒绝服务攻击和ssrf漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TransformerFactory factory = TransformerFactory.newInstance();</span><br><span class="line">factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, &quot;all&quot;);</span><br><span class="line">factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, &quot;all&quot;);</span><br><span class="line"></span><br><span class="line">Transformer transformer = factory.newTransformer();</span><br><span class="line">transformer.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</span><br><span class="line"></span><br><span class="line">transformer.transform(input, result);</span><br></pre></td></tr></table></figure>

<p><strong>禁用DTD的解决方案:</strong><br>通过禁用DTD，大多数的xxe攻击都可以被避免</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TransformerFactory factory = TransformerFactory.newInstance();</span><br><span class="line">factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</span><br><span class="line"></span><br><span class="line">Transformer transformer = factory.newTransformer();</span><br><span class="line">transformer.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</span><br><span class="line"></span><br><span class="line">transformer.transform(input, result);</span><br></pre></td></tr></table></figure>

<p>引用：<br><a href="http://cwe.mitre.org/data/definitions/611.html" target="_blank" rel="noopener">CWE-611: Improper Restriction of XML External Entity Reference (‘XXE’)</a><br><a href="https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=61702260" target="_blank" rel="noopener">CERT: IDS10-J. Prevent XML external entity attacks</a><br><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing" target="_blank" rel="noopener">OWASP.org: XML External Entity (XXE) Processing</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Expansion" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Expansion</a><br><a href="http://www.ws-attacks.org/index.php/XML_External_Entity_DOS" target="_blank" rel="noopener">WS-Attacks.org: XML External Entity DOS</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Reference_Attack" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Reference Attack</a><br><a href="http://blog.h3xstream.com/2014/06/identifying-xml-external-entity.html" target="_blank" rel="noopener">Identifying Xml eXternal Entity vulnerability (XXE)</a></p>
<h1 id="XSLT解析导致xxe漏洞-TransformerFactory"><a href="#XSLT解析导致xxe漏洞-TransformerFactory" class="headerlink" title="XSLT解析导致xxe漏洞(TransformerFactory)"></a>XSLT解析导致xxe漏洞(TransformerFactory)</h1><p>漏洞特征：XXE_XSLT_TRANSFORM_FACTORY<br>当xml解析程序收到不信任的输入且如果xml解析程序支持外部实体解析的时候，那么造成xml实体解析攻击（xxe）<br>危害1：探测本地文件内容（xxe：xml 外部实体）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;</span><br><span class="line">   &lt;xsl:template match=&quot;/&quot;&gt;</span><br><span class="line">       &lt;xsl:value-of select=&quot;document(&apos;/etc/passwd&apos;)&quot;&gt;</span><br><span class="line">   &lt;/xsl:value-of&gt;&lt;/xsl:template&gt;</span><br><span class="line">&lt;/xsl:stylesheet&gt;</span><br></pre></td></tr></table></figure>

<p>解决方法：<br>为了避免解析xml带来的攻击，你应该按照下面的示例代码修改你的代码<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Transformer transformer = TransformerFactory.newInstance().newTransformer();</span><br><span class="line">transformer.transform(input, result);</span><br></pre></td></tr></table></figure>

<p>下面的两个片段展示了可能的解决方案。你可以使用其中一个，或者两个都使用</p>
<p><strong>使用”Secure processing” 模式的解决方案:</strong><br>这个设置能保护你能避免ssrf漏洞但是不能避免拒绝服务攻击</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">TransformerFactory factory = TransformerFactory.newInstance();</span><br><span class="line">factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, &quot;all&quot;);</span><br><span class="line">factory.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, &quot;all&quot;);</span><br><span class="line"></span><br><span class="line">Transformer transformer = factory.newTransformer();</span><br><span class="line">transformer.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</span><br><span class="line"></span><br><span class="line">transformer.transform(input, result);</span><br></pre></td></tr></table></figure>

<p><strong>禁用DTD的解决方案:</strong><br>这个设置能保护你能避免ssrf漏洞但是不能避免拒绝服务攻击</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">TransformerFactory factory = TransformerFactory.newInstance();</span><br><span class="line">factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);</span><br><span class="line"></span><br><span class="line">Transformer transformer = factory.newTransformer();</span><br><span class="line">transformer.setOutputProperty(OutputKeys.INDENT, &quot;yes&quot;);</span><br><span class="line"></span><br><span class="line">transformer.transform(input, result);</span><br></pre></td></tr></table></figure>

<p>引用：<br><a href="http://cwe.mitre.org/data/definitions/611.html" target="_blank" rel="noopener">CWE-611: Improper Restriction of XML External Entity Reference (‘XXE’)</a><br><a href="https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=61702260" target="_blank" rel="noopener">CERT: IDS10-J. Prevent XML external entity attacks</a><br><a href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing" target="_blank" rel="noopener">OWASP.org: XML External Entity (XXE) Processing</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Expansion" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Expansion</a><br><a href="http://www.ws-attacks.org/index.php/XML_External_Entity_DOS" target="_blank" rel="noopener">WS-Attacks.org: XML External Entity DOS</a><br><a href="http://www.ws-attacks.org/index.php/XML_Entity_Reference_Attack" target="_blank" rel="noopener">WS-Attacks.org: XML Entity Reference Attack</a><br><a href="http://blog.h3xstream.com/2014/06/identifying-xml-external-entity.html" target="_blank" rel="noopener">Identifying Xml eXternal Entity vulnerability (XXE)</a></p>
<h1 id="潜在的XPath注入"><a href="#潜在的XPath注入" class="headerlink" title="潜在的XPath注入"></a>潜在的XPath注入</h1><p>漏洞特征： XPATH_INJECTION<br>XPath注入的危险程度就像sql注入一样。如果XPath查询包含不信任的用户输入，那么数据库就会被完全暴露。这样就可以让攻击者访问未授权的数据或者在目标xml数据库中放入恶意数据。</p>
<p>引用：<br>[WASC-39: XPath Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="http://cwe.mitre.org/data/definitions/643.html" target="_blank" rel="noopener">CWE-643: Improper Neutralization of Data within XPath Expressions (‘XPath Injection’)</a><br><a href="https://www.securecoding.cert.org/confluence/pages/viewpage.action?pageId=61407250" target="_blank" rel="noopener">CERT: IDS09-J. Prevent XPath Injection (archive)</a><br><a href="http://media.blackhat.com/bh-eu-12/Siddharth/bh-eu-12-Siddharth-Xpath-WP.pdf" target="_blank" rel="noopener">Black Hat Europe 2012: Hacking XPath 2.0</a><br><a href="http://www.balisage.net/Proceedings/vol7/html/Vlist02/BalisageVol7-Vlist02.html" target="_blank" rel="noopener">Balisage: XQuery Injection</a></p>
<h1 id="发现Struts-1-服务器端"><a href="#发现Struts-1-服务器端" class="headerlink" title="发现Struts 1 服务器端"></a>发现Struts 1 服务器端</h1><p>漏洞特征： STRUTS1_ENDPOINT<br>这个类是Struts 1 的Action<br>曾清一个请求被路由到一个控制器中，Form对象将会被自动的实例化为http参数的对象。这些参数应该被严格检查，以保证它们是安全的。</p>
<h1 id="发现Struts-2-服务器端"><a href="#发现Struts-2-服务器端" class="headerlink" title="发现Struts 2 服务器端"></a>发现Struts 2 服务器端</h1><p>漏洞特征：STRUTS2_ENDPOINT<br>在Struts 2中，服务器端是简单的Java对象 (POJOs)，这就意味着没有接口/类 需要被实现/拓展</p>
<p>当一个请求被路由到它的控制器的时候（像这些被选择的类），http提供的参数会被自动的映射到类中的setters中。所以，所有类中的setters都应该被看成来自不被信任源的输入，即使form中没有包含那些值。一个攻击者都被在请求中插入一些额外的值，他们会被当成对象，只要对象具有这样的setter。这些参数应该被严格检查，以保证它们是安全的。</p>
<h1 id="发现Spring-服务器端"><a href="#发现Spring-服务器端" class="headerlink" title="发现Spring 服务器端"></a>发现Spring 服务器端</h1><p>漏洞特征： SPRING_ENDPOINT<br>这个类是一个Spring的控制器。所有方法的注解都在RequestMapping（还有一些简化注解在GetMapping, PostMapping, PutMapping, DeleteMapping, 和 PatchMapping），这些方法都能被远程访问到。这些类应该被严格的分析，以保证暴露给远程的方法是安全的，不会被攻击者轻易攻击。</p>
<h1 id="Spring关闭-CSRF保护"><a href="#Spring关闭-CSRF保护" class="headerlink" title="Spring关闭 CSRF保护"></a>Spring关闭 CSRF保护</h1><p>漏洞特征： SPRING_CSRF_PROTECTION_DISABLED<br>对于标准的web应用程序来讲，关闭Spring的CSRF保护显然是不安全的。<br>禁用此保护的有效使用场景是服务器暴露一个可以改变状态的接口，这个接口仅可以被非浏览器操控。</p>
<p><strong>不安全的配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@EnableWebSecurity</span><br><span class="line">public class WebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        http.csrf().disable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引用：<br><a href="https://docs.spring.io/spring-security/site/docs/current/reference/html/csrf.html#when-to-use-csrf-protection" target="_blank" rel="noopener">Spring Security Official Documentation: When to use CSRF protection</a><br><a href="https://docs.spring.io/spring-security/site/docs/current/reference/html/csrf.html#when-to-use-csrf-protection" target="_blank" rel="noopener">OWASP: Cross-Site Request Forgery</a><br><a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: CSRF Prevention Cheat Sheet</a><br><a href="https://cwe.mitre.org/data/definitions/352.html" target="_blank" rel="noopener">CWE-352: Cross-Site Request Forgery (CSRF)</a></p>
<h1 id="Spring-中不受CSRF限制的RequestMapping"><a href="#Spring-中不受CSRF限制的RequestMapping" class="headerlink" title="Spring 中不受CSRF限制的RequestMapping"></a>Spring 中不受CSRF限制的RequestMapping</h1><p>漏洞特征： SPRING_CSRF_UNRESTRICTED_REQUEST_MAPPING<br>通过默认的映射所有的HTTP请求方法都会被RequestMapping注解。可是，http请求中的GET, HEAD, TRACE, 和OPTIONS（可能会导致tokens被泄露）方法不会默认开启csrf保护。所以，被RequestMapping注解的可以改变状态的方法和 POST, PUT, DELETE, 或者 PATCH这些http请求方法都会受到csrf攻击。</p>
<p>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class UnsafeController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/path&quot;)</span><br><span class="line">    public void writeData() &#123;</span><br><span class="line">        // State-changing operations performed within this method.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决方案（Spring Framework 4.3和更新的版本）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class SafeController &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * For methods without side-effects use @GetMapping.</span><br><span class="line">     */</span><br><span class="line">    @GetMapping(&quot;/path&quot;)</span><br><span class="line">    public String readData() &#123;</span><br><span class="line">        // No state-changing operations performed within this method.</span><br><span class="line">        return &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * For state-changing methods use either @PostMapping, @PutMapping, @DeleteMapping, or @PatchMapping.</span><br><span class="line">     */</span><br><span class="line">    @PostMapping(&quot;/path&quot;)</span><br><span class="line">    public void writeData() &#123;</span><br><span class="line">        // State-changing operations performed within this method.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决方案（在Spring Framework 4.3之前的版本）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class SafeController &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * For methods without side-effects use either</span><br><span class="line">     * RequestMethod.GET, RequestMethod.HEAD, RequestMethod.TRACE, or RequestMethod.OPTIONS.</span><br><span class="line">     */</span><br><span class="line">    @RequestMapping(value = &quot;/path&quot;, method = RequestMethod.GET)</span><br><span class="line">    public String readData() &#123;</span><br><span class="line">        // No state-changing operations performed within this method.</span><br><span class="line">        return &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * For state-changing methods use either</span><br><span class="line">     * RequestMethod.POST, RequestMethod.PUT, RequestMethod.DELETE, or RequestMethod.PATCH.</span><br><span class="line">     */</span><br><span class="line">    @RequestMapping(value = &quot;/path&quot;, method = RequestMethod.POST)</span><br><span class="line">    public void writeData() &#123;</span><br><span class="line">        // State-changing operations performed within this method.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引用：<br>[Spring Security Official Documentation: Use proper HTTP verbs (CSRF protection)](Spring Security Official Documentation: Use proper HTTP verbs (CSRF protection))<br>[OWASP: Cross-Site Request Forgery](OWASP: Cross-Site Request Forgery)<br><a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: CSRF Prevention Cheat Sheet</a><br><a href="https://cwe.mitre.org/data/definitions/352.html" target="_blank" rel="noopener">CWE-352: Cross-Site Request Forgery (CSRF)</a></p>
<h1 id="潜在的注入（custom）"><a href="#潜在的注入（custom）" class="headerlink" title="潜在的注入（custom）"></a>潜在的注入（custom）</h1><p>漏洞特征： CUSTOM_INJECTION<br>扫描工具所识别的函数存在注射问题。应验证输入并争取转义。</p>
<p>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SqlUtil.execQuery(&quot;select * from UserEntity t where id = &quot; + parameterInput);</span><br></pre></td></tr></table></figure>

<p>wiki在线有很详细的教程关于<a href="https://github.com/find-sec-bugs/find-sec-bugs/wiki/Custom-signatures" target="_blank" rel="noopener">如何配置custom</a></p>
<p>引用：<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a><br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a></p>
<h1 id="潜在的sql注入"><a href="#潜在的sql注入" class="headerlink" title="潜在的sql注入"></a>潜在的sql注入</h1><p>漏洞特征：SQL_INJECTION<br>输入进sql查询的数据应该通过严格的检查。在预编译中绑定参数可以更容易的缓解sql注入带来的危害。或者，每一个参数应该被正确的转义。<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createQuery(&quot;select * from User where id = &apos;&quot;+inputId+&quot;&apos;&quot;);</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import org.owasp.esapi.Encoder;</span><br><span class="line"></span><br><span class="line">createQuery(&quot;select * from User where id = &apos;&quot;+Encoder.encodeForSQL(inputId)+&quot;&apos;&quot;);</span><br></pre></td></tr></table></figure>

<p>引用（sql注入）<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a><br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a></p>
<h1 id="在Turbine中潜在的sql注入"><a href="#在Turbine中潜在的sql注入" class="headerlink" title="在Turbine中潜在的sql注入"></a>在Turbine中潜在的sql注入</h1><p>漏洞特征：SQL_INJECTION_TURBINE<br>输入进sql查询的数据应该通过严格的检查。在预编译中绑定参数可以更容易的缓解sql注入带来的危害。或者，每一个参数应该被正确的转义。<br>Turbine API 提供DSL在java代码中构建查询<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Record&gt; BasePeer.executeQuery( &quot;select * from Customer where id=&quot; + inputId );</span><br></pre></td></tr></table></figure>

<p>解决方案（使用Criteria DSL）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Criteria c = new Criteria();</span><br><span class="line">c.add( CustomerPeer.ID, inputId );</span><br><span class="line"></span><br><span class="line">List&lt;Customer&gt; customers = CustomerPeer.doSelect( c );</span><br></pre></td></tr></table></figure>

<p>解决方案（使用特殊方法）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Customer customer = CustomerPeer.retrieveByPK( new NumberKey( inputId ) );</span><br></pre></td></tr></table></figure>

<p>解决方法（使用OWASP提供的编码方法）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import org.owasp.esapi.Encoder;</span><br><span class="line"></span><br><span class="line">BasePeer.executeQuery(&quot;select * from Customer where id = &apos;&quot;+Encoder.encodeForSQL(inputId)+&quot;&apos;&quot;);</span><br></pre></td></tr></table></figure>

<p>引用(Turbine)：<br><a href="https://turbine.apache.org/turbine/turbine-2.1/howto/criteria-howto.html" target="_blank" rel="noopener">Turbine Documentation: Criteria Howto</a><br>引用（sql注入）<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a><br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a></p>
<h1 id="潜在的SQL-HQL注入-Hibernate"><a href="#潜在的SQL-HQL注入-Hibernate" class="headerlink" title="潜在的SQL/HQL注入(Hibernate)"></a>潜在的SQL/HQL注入(Hibernate)</h1><p>漏洞特征：SQL_INJECTION_HIBERNATE<br>输入进sql查询的数据应该通过严格的检查。在预编译中绑定参数可以更容易的缓解sql注入带来的危害。或者，可以使用Hibernate的Criteria。<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Session session = sessionFactory.openSession();</span><br><span class="line">Query q = session.createQuery(&quot;select t from UserEntity t where id = &quot; + input);</span><br><span class="line">q.execute();</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Session session = sessionFactory.openSession();</span><br><span class="line">Query q = session.createQuery(&quot;select t from UserEntity t where id = :userId&quot;);</span><br><span class="line">q.setString(&quot;userId&quot;,input);</span><br><span class="line">q.execute();</span><br></pre></td></tr></table></figure>

<p>动态查询参数法解决方案（Hibernate Criteria）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Session session = sessionFactory.openSession();</span><br><span class="line">Query q = session.createCriteria(UserEntity.class)</span><br><span class="line">    .add( Restrictions.like(&quot;id&quot;, input) )</span><br><span class="line">    .list();</span><br><span class="line">q.execute();</span><br></pre></td></tr></table></figure>

<p>引用(Hibernate)<br><a href="https://docs.jboss.org/hibernate/orm/3.3/reference/en/html/querycriteria.html" target="_blank" rel="noopener">Hibernate Documentation: Query Criteria</a><br><a href="https://docs.jboss.org/hibernate/orm/3.2/api/org/hibernate/Query.html" target="_blank" rel="noopener">Hibernate Javadoc: Query Object</a><br><a href="http://blog.h3xstream.com/2014/02/hql-for-pentesters.html" target="_blank" rel="noopener">HQL for pentesters: Guideline to test if the suspected code is exploitable.</a><br>引用（sql注入）<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a><br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a></p>
<h1 id="潜在的sql-JDOQL注入-JDO"><a href="#潜在的sql-JDOQL注入-JDO" class="headerlink" title="潜在的sql/JDOQL注入(JDO)"></a>潜在的sql/JDOQL注入(JDO)</h1><p>漏洞特征：SQL_INJECTION_JDO<br>输入进sql查询的数据应该通过严格的检查。在预编译中绑定参数可以更容易的缓解sql注入带来的危害。<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PersistenceManager pm = getPM();</span><br><span class="line"></span><br><span class="line">Query q = pm.newQuery(&quot;select * from Users where name = &quot; + input);</span><br><span class="line">q.execute();</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PersistenceManager pm = getPM();</span><br><span class="line"></span><br><span class="line">Query q = pm.newQuery(&quot;select * from Users where name = nameParam&quot;);</span><br><span class="line">q.declareParameters(&quot;String nameParam&quot;);</span><br><span class="line">q.execute(input);</span><br></pre></td></tr></table></figure>

<p>引用(JDO)：<br><a href="https://db.apache.org/jdo/object_retrieval.html" target="_blank" rel="noopener">JDO: Object Retrieval</a><br>引用（sql注入）<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a><br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a></p>
<h1 id="潜在的sql-JPQL注入-JPA"><a href="#潜在的sql-JPQL注入-JPA" class="headerlink" title="潜在的sql/JPQL注入(JPA)"></a>潜在的sql/JPQL注入(JPA)</h1><p>漏洞特征： SQL_INJECTION_JPA<br>输入进sql查询的数据应该通过严格的检查。在预编译中绑定参数可以更容易的缓解sql注入带来的危害。<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EntityManager pm = getEM();</span><br><span class="line"></span><br><span class="line">TypedQuery&lt;UserEntity&gt; q = em.createQuery(</span><br><span class="line">    String.format(&quot;select * from Users where name = %s&quot;, username),</span><br><span class="line">    UserEntity.class);</span><br><span class="line"></span><br><span class="line">UserEntity res = q.getSingleResult();</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TypedQuery&lt;UserEntity&gt; q = em.createQuery(</span><br><span class="line">    &quot;select * from Users where name = usernameParam&quot;,UserEntity.class)</span><br><span class="line">    .setParameter(&quot;usernameParam&quot;, username);</span><br><span class="line"></span><br><span class="line">UserEntity res = q.getSingleResult();</span><br></pre></td></tr></table></figure>

<p>引用 (JPA)<br><a href="http://docs.oracle.com/javaee/6/tutorial/doc/bnbrg.html" target="_blank" rel="noopener">The Java EE 6 Tutorial: Creating Queries Using the Java Persistence Query Language</a><br>引用（sql注入）<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a><br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a></p>
<h1 id="潜在的JDBC注入-Spring-JDBC"><a href="#潜在的JDBC注入-Spring-JDBC" class="headerlink" title="潜在的JDBC注入(Spring JDBC)"></a>潜在的JDBC注入(Spring JDBC)</h1><p>漏洞特征：SQL_INJECTION_SPRING_JDBC<br>输入进sql查询的数据应该通过严格的检查。在预编译中绑定参数可以更容易的缓解sql注入带来的危害。或者，每一个参数应该被正确的转义。<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JdbcTemplate jdbc = new JdbcTemplate();</span><br><span class="line">int count = jdbc.queryForObject(&quot;select count(*) from Users where name = &apos;&quot;+paramName+&quot;&apos;&quot;, Integer.class);</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JdbcTemplate jdbc = new JdbcTemplate();</span><br><span class="line">int count = jdbc.queryForObject(&quot;select count(*) from Users where name = ?&quot;, Integer.class, paramName);</span><br></pre></td></tr></table></figure>

<p>引用 (Spring JDBC)<br><a href="http://docs.spring.io/spring-framework/docs/current/spring-framework-reference/html/jdbc.html" target="_blank" rel="noopener">Spring Official Documentation: Data access with JDBC</a><br>引用（sql注入）<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a><br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a></p>
<h1 id="潜在的JDBC注入"><a href="#潜在的JDBC注入" class="headerlink" title="潜在的JDBC注入"></a>潜在的JDBC注入</h1><p>漏洞特征：SQL_INJECTION_JDBC<br>输入进sql查询的数据应该通过严格的检查。在预编译中绑定参数可以更容易的缓解sql注入带来的危害。<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Connection conn = [...];</span><br><span class="line">Statement stmt = con.createStatement();</span><br><span class="line">ResultSet rs = stmt.executeQuery(&quot;update COFFEES set SALES = &quot;+nbSales+&quot; where COF_NAME = &apos;&quot;+coffeeName+&quot;&apos;&quot;);</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Connection conn = [...];</span><br><span class="line">conn.prepareStatement(&quot;update COFFEES set SALES = ? where COF_NAME = ?&quot;);</span><br><span class="line">updateSales.setInt(1, nbSales);</span><br><span class="line">updateSales.setString(2, coffeeName);</span><br></pre></td></tr></table></figure>

<p>引用 (JDBC)<br><a href="http://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html" target="_blank" rel="noopener">Oracle Documentation: The Java Tutorials &gt; Prepared Statements</a><br>引用（sql注入）<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a><br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a></p>
<h1 id="潜在的Scala-Slick注入"><a href="#潜在的Scala-Slick注入" class="headerlink" title="潜在的Scala Slick注入"></a>潜在的Scala Slick注入</h1><p>漏洞特征：SCALA_SQL_INJECTION_SLICK<br>输入进sql查询的数据应该通过严格的检查。在预编译中绑定参数可以更容易的缓解sql注入带来的危害。<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.run &#123;</span><br><span class="line">  sql&quot;select * from people where name = &apos;#$value&apos;&quot;.as[Person]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.run &#123;</span><br><span class="line">  sql&quot;select * from people where name = $value&quot;.as[Person]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引用（sql注入）<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a><br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a></p>
<h1 id="潜在的Scala-Anorm注入"><a href="#潜在的Scala-Anorm注入" class="headerlink" title="潜在的Scala Anorm注入"></a>潜在的Scala Anorm注入</h1><p>漏洞特征：SCALA_SQL_INJECTION_ANORM<br>输入进sql查询的数据应该通过严格的检查。在预编译中绑定参数可以更容易的缓解sql注入带来的危害。<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val peopleParser = Macro.parser[Person](&quot;id&quot;, &quot;name&quot;, &quot;age&quot;)</span><br><span class="line"></span><br><span class="line">DB.withConnection &#123; implicit c =&gt;</span><br><span class="line">  val people: List[Person] = SQL(&quot;select * from people where name = &apos;&quot; + value + &quot;&apos;&quot;).as(peopleParser.*)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val peopleParser = Macro.parser[Person](&quot;id&quot;, &quot;name&quot;, &quot;age&quot;)</span><br><span class="line"></span><br><span class="line">DB.withConnection &#123; implicit c =&gt;</span><br><span class="line">  val people: List[Person] = SQL&quot;select * from people where name = $value&quot;.as(peopleParser.*)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引用（sql注入）<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a><br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a></p>
<h1 id="潜在的安卓sql注入"><a href="#潜在的安卓sql注入" class="headerlink" title="潜在的安卓sql注入"></a>潜在的安卓sql注入</h1><p>漏洞特征：SQL_INJECTION_ANDROID<br>输入进sql查询的数据应该通过严格的检查。在预编译中绑定参数可以更容易的缓解sql注入带来的危害。<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String query = &quot;SELECT * FROM  messages WHERE uid= &apos;&quot;+userInput+&quot;&apos;&quot; ;</span><br><span class="line">Cursor cursor = this.getReadableDatabase().rawQuery(query,null);</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String query = &quot;SELECT * FROM  messages WHERE uid= ?&quot; ;</span><br><span class="line">Cursor cursor = this.getReadableDatabase().rawQuery(query,new String[] &#123;userInput&#125;);</span><br></pre></td></tr></table></figure>

<p>引用 (Android SQLite)<br><a href="http://www.informit.com/articles/article.aspx?p=2268753&seqNum=5" target="_blank" rel="noopener">InformIT.com: Practical Advice for Building Secure Android Databases in SQLite</a><br><a href="https://www.packtpub.com/books/content/knowing-sql-injection-attacks-and-securing-our-android-applications-them" target="_blank" rel="noopener">Packtpub.com: Knowing the SQL-injection attacks and securing our Android applications from them</a></p>
<p><a href="https://books.google.ca/books?id=SXlMAQAAQBAJ&lpg=PR1&pg=PA64#v=onepage&q&f=false" target="_blank" rel="noopener">Android Database Support (Enterprise Android: Programming Android Database Applications for the Enterprise)</a></p>
<p><a href="https://stackoverflow.com/a/29797229/89769" target="_blank" rel="noopener">Safe example of Insert, Select, Update and Delete queryies provided by Suragch</a></p>
<p>引用（sql注入）<br>[WASC-19: SQL Injection](<a href="http://projects.webappsec.org/w/page/13246963/SQL" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246963/SQL</a> Injection)<br><a href="http://capec.mitre.org/data/definitions/66.html" target="_blank" rel="noopener">CAPEC-66: SQL Injection</a><br><a href="http://cwe.mitre.org/data/definitions/89.html" target="_blank" rel="noopener">CWE-89: Improper Neutralization of Special Elements used in an SQL Command (‘SQL Injection’)</a><br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="https://www.owasp.org/index.php/SQL_Injection_Prevention_Cheat_Sheet" target="_blank" rel="noopener">OWASP: SQL Injection Prevention Cheat Sheet</a><br><a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noopener">OWASP: Query Parameterization Cheat Sheet</a></p>
<h1 id="潜在的LDAP注入"><a href="#潜在的LDAP注入" class="headerlink" title="潜在的LDAP注入"></a>潜在的LDAP注入</h1><p>漏洞特征：LDAP_INJECTION<br>就像sql，所有进入到ldap查询的语句都必须要保证安全。不幸的是，ldap没有像sql那样的预编译接口。所以，现在的主要防御方式是，在参数进入ladp查询之前对其进行严格的检验。<br>有漏洞的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NamingEnumeration&lt;SearchResult&gt; answers = context.search(&quot;dc=People,dc=example,dc=com&quot;,</span><br><span class="line">        &quot;(uid=&quot; + username + &quot;)&quot;, ctrls);</span><br></pre></td></tr></table></figure>

<p>引用：<br>[WASC-29: LDAP Injection](<a href="http://projects.webappsec.org/w/page/13246947/LDAP" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246947/LDAP</a> Injection)<br><a href="https://www.owasp.org/index.php/Top_10_2013-A1-Injection" target="_blank" rel="noopener">OWASP: Top 10 2013-A1-Injection</a><br><a href="http://cwe.mitre.org/data/definitions/90.html" target="_blank" rel="noopener">CWE-90: Improper Neutralization of Special Elements used in an LDAP Query (‘LDAP Injection’)</a><br><a href="http://www.veracode.com/security/ldap-injection" target="_blank" rel="noopener">LDAP Injection Guide: Learn How to Detect LDAP Injections and Improve LDAP Security</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/02/Java%E5%AE%A1%E8%AE%A1-DAY4/" rel="next" title="Java审计-DAY4">
                <i class="fa fa-chevron-left"></i> Java审计-DAY4
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/11/04/Apache%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE/" rel="prev" title="Apache安全配置">
                Apache安全配置 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">白仁</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Java审计-DAY2"><span class="nav-number">1.</span> <span class="nav-text">Java审计-DAY2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xml解析导致xxe漏洞"><span class="nav-number">2.</span> <span class="nav-text">xml解析导致xxe漏洞</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xml解析导致xxe漏洞-XPathExpression"><span class="nav-number">3.</span> <span class="nav-text">xml解析导致xxe漏洞(XPathExpression)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xml解析导致xxe漏洞-SAXParser"><span class="nav-number">4.</span> <span class="nav-text">xml解析导致xxe漏洞(SAXParser)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xml解析导致xxe漏洞-XMLReader"><span class="nav-number">5.</span> <span class="nav-text">xml解析导致xxe漏洞(XMLReader)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xml解析导致xxe漏洞-DocumentBuilder"><span class="nav-number">6.</span> <span class="nav-text">xml解析导致xxe漏洞(DocumentBuilder)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#xml解析导致xxe漏洞-TransformerFactory"><span class="nav-number">7.</span> <span class="nav-text">xml解析导致xxe漏洞(TransformerFactory)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#XSLT解析导致xxe漏洞-TransformerFactory"><span class="nav-number">8.</span> <span class="nav-text">XSLT解析导致xxe漏洞(TransformerFactory)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的XPath注入"><span class="nav-number">9.</span> <span class="nav-text">潜在的XPath注入</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#发现Struts-1-服务器端"><span class="nav-number">10.</span> <span class="nav-text">发现Struts 1 服务器端</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#发现Struts-2-服务器端"><span class="nav-number">11.</span> <span class="nav-text">发现Struts 2 服务器端</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#发现Spring-服务器端"><span class="nav-number">12.</span> <span class="nav-text">发现Spring 服务器端</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring关闭-CSRF保护"><span class="nav-number">13.</span> <span class="nav-text">Spring关闭 CSRF保护</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-中不受CSRF限制的RequestMapping"><span class="nav-number">14.</span> <span class="nav-text">Spring 中不受CSRF限制的RequestMapping</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的注入（custom）"><span class="nav-number">15.</span> <span class="nav-text">潜在的注入（custom）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的sql注入"><span class="nav-number">16.</span> <span class="nav-text">潜在的sql注入</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在Turbine中潜在的sql注入"><span class="nav-number">17.</span> <span class="nav-text">在Turbine中潜在的sql注入</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的SQL-HQL注入-Hibernate"><span class="nav-number">18.</span> <span class="nav-text">潜在的SQL/HQL注入(Hibernate)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的sql-JDOQL注入-JDO"><span class="nav-number">19.</span> <span class="nav-text">潜在的sql/JDOQL注入(JDO)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的sql-JPQL注入-JPA"><span class="nav-number">20.</span> <span class="nav-text">潜在的sql/JPQL注入(JPA)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的JDBC注入-Spring-JDBC"><span class="nav-number">21.</span> <span class="nav-text">潜在的JDBC注入(Spring JDBC)</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的JDBC注入"><span class="nav-number">22.</span> <span class="nav-text">潜在的JDBC注入</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的Scala-Slick注入"><span class="nav-number">23.</span> <span class="nav-text">潜在的Scala Slick注入</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的Scala-Anorm注入"><span class="nav-number">24.</span> <span class="nav-text">潜在的Scala Anorm注入</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的安卓sql注入"><span class="nav-number">25.</span> <span class="nav-text">潜在的安卓sql注入</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#潜在的LDAP注入"><span class="nav-number">26.</span> <span class="nav-text">潜在的LDAP注入</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">白仁</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
